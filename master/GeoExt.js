var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||typeof Object.defineProperties=='function'?Object.defineProperty:function(b,c,a){a=a;if(b==Array.prototype||b==Object.prototype){return}b[c]=a.value};$jscomp.getGlobal=function(a){return typeof window!='undefined'&&window===a?a:typeof global!='undefined'&&global!=null?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(i,f,j,k){if(!f){return}var a=$jscomp.global;var b=i.split('.');for(var e=0;e<b.length-1;e++){var d=b[e];if(!(d in a)){a[d]={}}a=a[d]}var g=b[b.length-1];var h=a[g];var c=f(h);if(c==h||c==null){return}$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:c})};$jscomp.polyfill('Array.prototype.copyWithin',function(a){if(a){return a}var b=function(d,c,b){var e=this.length;d=Number(d);c=Number(c);b=Number(b!=null?b:e);if(d<c){b=Math.min(b,e);while(c<b){if(c in this){this[d++]=this[c++]}else {delete this[d++];c++}}}else {b=Math.min(b,e+c-d);d+=b-c;while(b>c){if(--b in this){this[--d]=this[b]}else {delete this[d]}}}return this};return b},'es6','es3');$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};if(!$jscomp.global['Symbol']){$jscomp.global['Symbol']=$jscomp.Symbol}};$jscomp.Symbol=function(){var a=0;function Symbol(b){return $jscomp.SYMBOL_PREFIX+(b||'')+a++}return Symbol}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global['Symbol'].iterator;if(!a){a=$jscomp.global['Symbol'].iterator=$jscomp.global['Symbol']('iterator')}if(typeof Array.prototype[a]!='function'){$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}})}$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){if(b<a.length){return {done:!1,value:a[b++]}}else {return {done:!0}}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();var a={next:b};a[$jscomp.global['Symbol'].iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();if(a instanceof String){a=a+''}var c=0;var b={next:function(){if(c<a.length){var e=c++;return {value:d(e,a[e]),done:!1}}b.next=function(){return {done:!0,value:void 0}};return b.next()}};$jscomp.initSymbol();$jscomp.initSymbolIterator();b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill('Array.prototype.entries',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b,c){return [b,c]})};return b},'es6','es3');$jscomp.polyfill('Array.prototype.fill',function(a){if(a){return a}var b=function(f,c,b){var d=this.length||0;if(c<0){c=Math.max(0,d+c)}if(b==null||b>d){b=d}b=Number(b);if(b<0){b=Math.max(0,d+b)}for(var e=Number(c||0);e<b;e++){this[e]=f}return this};return b},'es6','es3');$jscomp.findInternal=function(a,d,e){if(a instanceof String){a=String(a)}var f=a.length;for(var b=0;b<f;b++){var c=a[b];if(d.call(e,c,b,a)){return {i:b,v:c}}}return {i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(a){if(a){return a}var b=function(c,b){return $jscomp.findInternal(this,c,b).v};return b},'es6','es3');$jscomp.polyfill('Array.prototype.findIndex',function(a){if(a){return a}var b=function(c,b){return $jscomp.findInternal(this,c,b).i};return b},'es6','es3');$jscomp.polyfill('Array.from',function(a){if(a){return a}var b=function(b,c,g){$jscomp.initSymbolIterator();c=c!=null?c:function(d){return d};var e=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=b[Symbol.iterator];if(typeof f=='function'){b=f.call(b);var h;var j=0;while(!(h=b.next()).done){e.push(c.call(g,h.value,j++))}}else {var i=b.length;for(var d=0;d<i;d++){e.push(c.call(g,b[d],d))}}return e};return b},'es6','es3');$jscomp.polyfill('Object.is',function(a){if(a){return a}var b=function(b,c){if(b===c){return b!==0||1/b===1/c}else {return b!==b&&c!==c}};return b},'es6','es3');$jscomp.polyfill('Array.prototype.includes',function(a){if(a){return a}var b=function(d,g){var c=this;if(c instanceof String){c=String(c)}var f=c.length;var b=g||0;if(b<0){b=Math.max(b+f,0)}for(;b<f;b++){var e=c[b];if(e===d||Object.is(e,d)){return !0}}return !1};return b},'es7','es3');$jscomp.polyfill('Array.prototype.keys',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b){return b})};return b},'es6','es3');$jscomp.polyfill('Array.of',function(a){if(a){return a}var b=function(b){return Array.from(arguments)};return b},'es6','es3');$jscomp.polyfill('Array.prototype.values',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(c,b){return b})};return b},'es8','es3');$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.polyfill('Promise',function(c){if(c&&!$jscomp.FORCE_POLYFILL_PROMISE){return c}function AsyncExecutor(){this.batch_=null}AsyncExecutor.prototype.asyncExecute=function(a){if(this.batch_==null){this.batch_=[];this.asyncExecuteBatch_()}this.batch_.push(a);return this};AsyncExecutor.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global['setTimeout'];AsyncExecutor.prototype.asyncExecuteFunction=function(a){e(a,0)};AsyncExecutor.prototype.executeBatch_=function(){while(this.batch_&&this.batch_.length){var b=this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var d=b[a];b[a]=null;try{d()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};AsyncExecutor.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a})};var b={PENDING:0,FULFILLED:1,REJECTED:2};var a=function(d){this.state_=b.PENDING;this.result_=undefined;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{d(a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.createResolveAndReject_=function(){var b=this;var a=!1;function firstCallWins(d){return function(e){if(!a){a=!0;d.call(b,e)}}}return {resolve:firstCallWins(this.resolveTo_),reject:firstCallWins(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this){this.reject_(new TypeError('A Promise cannot resolve to itself'))}else {if(b instanceof a){this.settleSameAsPromise_(b)}else {if(isObject(b)){this.resolveToNonPromiseObj_(b)}else {this.fulfill_(b)}}}};a.prototype.resolveToNonPromiseObj_=function(b){var a=undefined;try{a=b.then}catch(f){this.reject_(f);return}if(typeof a=='function'){this.settleSameAsThenable_(a,b)}else {this.fulfill_(b)}};function isObject(a){switch(typeof a){case 'object':return a!=null;case 'function':return !0;default:return !1;}}a.prototype.reject_=function(a){this.settle_(b.REJECTED,a)};a.prototype.fulfill_=function(a){this.settle_(b.FULFILLED,a)};a.prototype.settle_=function(d,a){if(this.state_!=b.PENDING){throw new Error('Cannot settle('+d+', '+a+'): Promise already settled in state'+this.state_)}this.state_=d;this.result_=a;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){for(var a=0;a<this.onSettledCallbacks_.length;++a){d.asyncExecute(this.onSettledCallbacks_[a])}this.onSettledCallbacks_=null}};var d=new AsyncExecutor();a.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};a.prototype.settleSameAsThenable_=function(b,d){var a=this.createResolveAndReject_();try{b.call(d,a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.then=function(f,g){var b;var d;var e=new a(function(a,e){b=a;d=e});function createCallback(a,e){if(typeof a=='function'){return function(h){try{b(a(h))}catch(i){d(i)}}}else {return e}}this.callWhenSettled_(createCallback(f,b),createCallback(g,d));return e};a.prototype['catch']=function(a){return this.then(undefined,a)};a.prototype.callWhenSettled_=function(e,f){var a=this;function callback(){switch(a.state_){case b.FULFILLED:e(a.result_);break;case b.REJECTED:f(a.result_);break;default:throw new Error('Unexpected state: '+a.state_);}}if(this.onSettledCallbacks_==null){d.asyncExecute(callback)}else {this.onSettledCallbacks_.push(callback)}};function resolvingPromise(b){if(b instanceof a){return b}else {return new a(function(a,d){a(b)})}}a['resolve']=resolvingPromise;a['reject']=function(b){return new a(function(d,a){a(b)})};a['race']=function(b){return new a(function(e,f){var d=$jscomp.makeIterator(b);for(var a=d.next();!a.done;a=d.next()){resolvingPromise(a.value).callWhenSettled_(e,f)}})};a['all']=function(e){var d=$jscomp.makeIterator(e);var b=d.next();if(b.done){return resolvingPromise([])}else {return new a(function(g,h){var a=[];var f=0;function onFulfilled(b){return function(d){a[b]=d;f--;if(f==0){g(a)}}}do{a.push(undefined);f++;resolvingPromise(b.value).callWhenSettled_(onFulfilled(a.length-1),h);b=d.next()}while(!b.done)})}};return a},'es6','es3');$jscomp.polyfill('Promise.prototype.finally',function(a){if(a){return a}var b=function(b){return this.then(function(d){var c=Promise.resolve(b());return c.then(function(){return d})},function(d){var c=Promise.resolve(b());return c.then(function(){throw d})})};return b},'es9','es3');$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0};var a={};try{a.__proto__=b;return a.a}catch(c){}return !1};$jscomp.setPrototypeOf=typeof Object.setPrototypeOf=='function'?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b){throw new TypeError(a+' is not extensible')}return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(a instanceof Object){return}throw new TypeError('Iterator result '+a+' is not an object')};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=undefined;this.nextAddress=1;this.catchAddress_=0;this.finallyAddress_=0;this.abruptCompletion_=null;this.finallyContexts_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_){throw new TypeError('Generator is already running')}this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype['return']=function(a){this.abruptCompletion_={'return':a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(b,a){this.nextAddress=a;return {value:b}};$jscomp.generator.Context.prototype.yieldAll=function(d,b){var c=$jscomp.makeIterator(d);var a=c.next();$jscomp.generator.ensureIteratorResultIsObject_(a);if(a.done){this.yieldResult=a.value;this.nextAddress=b;return}this.yieldAllIterator_=c;return this.yield(a.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(b,a){this.catchAddress_=b;if(a!=undefined){this.finallyAddress_=a}};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(b,a){this.nextAddress=b;this.catchAddress_=a||0};$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;var b=this.abruptCompletion_.exception;this.abruptCompletion_=null;return b};$jscomp.generator.Context.prototype.enterFinallyBlock=function(c,b,a){if(!a){this.finallyContexts_=[this.abruptCompletion_]}else {this.finallyContexts_[a]=this.abruptCompletion_}this.catchAddress_=c||0;this.finallyAddress_=b||0};$jscomp.generator.Context.prototype.leaveFinallyBlock=function(d,c){var b=this.finallyContexts_.splice(c||0)[0];var a=this.abruptCompletion_=this.abruptCompletion_||b;if(a){if(a.isException){return this.jumpToErrorHandler_()}if(a.jumpTo!=undefined&&this.finallyAddress_<a.jumpTo){this.nextAddress=a.jumpTo;this.abruptCompletion_=null}else {this.nextAddress=this.finallyAddress_}}else {this.nextAddress=d}};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a){this.properties_.push(b)}this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){while(this.properties_.length>0){var a=this.properties_.pop();if(a in this.object_){return a}}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context();this.program_=a};$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_){return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_)}this.context_.next_(a);return this.nextStep_()};$jscomp.generator.Engine_.prototype.return_=function(b){this.context_.start_();var a=this.context_.yieldAllIterator_;if(a){var c='return' in a?a['return']:function(a){return {value:a,done:!0}};return this.yieldAllStep_(c,b,this.context_['return'])}this.context_['return'](b);return this.nextStep_()};$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_){return this.yieldAllStep_(this.context_.yieldAllIterator_['throw'],a,this.context_.next_)}this.context_.throw_(a);return this.nextStep_()};$jscomp.generator.Engine_.prototype.yieldAllStep_=function(d,e,c){try{var a=d.call(this.context_.yieldAllIterator_,e);$jscomp.generator.ensureIteratorResultIsObject_(a);if(!a.done){this.context_.stop_();return a}var b=a.value}catch(f){this.context_.yieldAllIterator_=null;this.context_.throw_(f);return this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,b);return this.nextStep_()};$jscomp.generator.Engine_.prototype.nextStep_=function(){while(this.context_.nextAddress){try{var b=this.program_(this.context_);if(b){this.context_.stop_();return {value:b.value,done:!1}}}catch(c){this.context_.yieldResult=undefined;this.context_.throw_(c)}}this.context_.stop_();if(this.context_.abruptCompletion_){var a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException){throw a.exception}return {value:a['return'],done:!0}}return {value:undefined,done:!0}};$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this['throw']=function(b){return a.throw_(b)};this['return']=function(b){return a.return_(b)};$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(b,c){var a=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(c));if($jscomp.setPrototypeOf){$jscomp.setPrototypeOf(a,b.prototype)}return a};$jscomp.asyncExecutePromiseGenerator=function(a){function passValueToGenerator(b){return a.next(b)}function passErrorToGenerator(b){return a['throw'](b)}return new Promise(function(b,c){function handleGeneratorRecord(d){if(d.done){b(d.value)}else {Promise.resolve(d.value).then(passValueToGenerator,passErrorToGenerator).then(handleGeneratorRecord,c)}}handleGeneratorRecord(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={};var b=Object.create(new $jscomp.global['Proxy'](a,{'get':function(d,e,c){return d==a&&e=='q'&&c==b}}));return b['q']===!0}catch(c){return !1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};$jscomp.polyfill('WeakMap',function(c){function isConformant(){if(!c||!Object.seal){return !1}try{var b=Object.seal({});var d=Object.seal({});var a=new c([[b,2],[d,3]]);if(a.get(b)!=2||a.get(d)!=3){return !1}a['delete'](b);a.set(d,4);return !a.has(b)&&a.get(d)==4}catch(e){return !1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE){return c}}else {if(isConformant()){return c}}var a='$jscomp_hidden_'+Math.random();function insert(b){if(!$jscomp.owns(b,a)){var d={};$jscomp.defineProperty(b,a,{value:d})}}function patch(a){var b=Object[a];if(b){Object[a]=function(d){insert(d);return b(d)}}}patch('freeze');patch('preventExtensions');patch('seal');var d=0;var b=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=$jscomp.makeIterator(a);var b;while(!(b=f.next()).done){var e=b.value;this.set(e[0],e[1])}}};b.prototype.set=function(b,d){insert(b);if(!$jscomp.owns(b,a)){throw new Error('WeakMap key fail: '+b)}b[a][this.id_]=d;return this};b.prototype.get=function(b){return $jscomp.owns(b,a)?b[a][this.id_]:undefined};b.prototype.has=function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)};b.prototype['delete']=function(b){if(!$jscomp.owns(b,a)||!$jscomp.owns(b[a],this.id_)){return !1}return delete b[a][this.id_]};return b},'es6','es3');$jscomp.MapEntry=function(){this.previous;this.next;this.head;this.key;this.value};$jscomp.polyfill('Map',function(b){function isConformant(){if($jscomp.ASSUME_NO_NATIVE_MAP||!b||typeof b!='function'||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=b;var e=Object.seal({x:4});var c=new b($jscomp.makeIterator([[e,'s']]));if(c.get(e)!='s'||c.size!=1||c.get({x:4})||c.set({x:4},'t')!=c||c.size!=2){return !1}var d=c.entries();var a=d.next();if(a.done||a.value[0]!=e||a.value[1]!='s'){return !1}a=d.next();if(a.done||a.value[0].x!=4||a.value[1]!='t'||!d.next().done){return !1}return !0}catch(i){return !1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE){return b}}else {if(isConformant()){return b}}$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=new WeakMap();var a=function(a){this.data_={};this.head_=f();this.size=0;if(a){var e=$jscomp.makeIterator(a);var c;while(!(c=e.next()).done){var d=c.value;this.set(d[0],d[1])}}};a.prototype.set=function(d,e){d=d===0?0:d;var a=c(this,d);if(!a.list){a.list=this.data_[a.id]=[]}if(!a.entry){a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:d,value:e};a.list.push(a.entry);this.head_.previous.next=a.entry;this.head_.previous=a.entry;this.size++}else {a.entry.value=e}return this};a.prototype['delete']=function(d){var a=c(this,d);if(a.entry&&a.list){a.list.splice(a.index,1);if(!a.list.length){delete this.data_[a.id]}a.entry.previous.next=a.entry.next;a.entry.next.previous=a.entry.previous;a.entry.head=null;this.size--;return !0}return !1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};a.prototype.has=function(a){return !!c(this,a).entry};a.prototype.get=function(d){var a=c(this,d).entry;return a&&a.value};a.prototype.entries=function(){return d(this,function(a){return [a.key,a.value]})};a.prototype.keys=function(){return d(this,function(a){return a.key})};a.prototype.values=function(){return d(this,function(a){return a.value})};a.prototype.forEach=function(e,d){var f=this.entries();var c;while(!(c=f.next()).done){var a=c.value;e.call(d,a[1],a[0],this)}};$jscomp.initSymbol();$jscomp.initSymbolIterator();a.prototype[Symbol.iterator]=a.prototype.entries;var c=function(g,e){var f=h(e);var a=g.data_[f];if(a&&$jscomp.owns(g.data_,f)){for(var d=0;d<a.length;d++){var c=a[d];if(e!==e&&c.key!==c.key||e===c.key){return {id:f,list:a,index:d,entry:c}}}}return {id:f,list:a,index:-1,entry:undefined}};var d=function(c,d){var a=c.head_;return $jscomp.iteratorPrototype(function(){if(a){while(a.head!=c.head_){a=a.previous}while(a.next!=a.head){a=a.next;return {done:!1,value:d(a)}}a=null}return {done:!0,value:void 0}})};var f=function(){var a={};a.previous=a.next=a.head=a;return a};var g=0;var h=function(a){var c=a&&typeof a;if(c=='object'||c=='function'){a=a;if(!e.has(a)){var d=''+ ++g;e.set(a,d);return d}return e.get(a)}return 'p_'+a};return a},'es6','es3');$jscomp.polyfill('Math.acosh',function(a){if(a){return a}var b=function(b){b=Number(b);return Math.log(b+Math.sqrt(b*b-1))};return b},'es6','es3');$jscomp.polyfill('Math.asinh',function(a){if(a){return a}var b=function(b){b=Number(b);if(b===0){return b}var c=Math.log(Math.abs(b)+Math.sqrt(b*b+1));return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Math.log1p',function(a){if(a){return a}var b=function(b){b=Number(b);if(b<0.25&&b>-0.25){var f=b;var g=1;var c=b;var d=0;var e=1;while(d!=c){f*=b;e*=-1;c=(d=c)+e*f/++g}return c}return Math.log(1+b)};return b},'es6','es3');$jscomp.polyfill('Math.atanh',function(b){if(b){return b}var a=Math.log1p;var c=function(c){c=Number(c);return (a(c)-a(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.cbrt',function(a){if(a){return a}var b=function(b){if(b===0){return b}b=Number(b);var c=Math.pow(Math.abs(b),1/3);return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Math.clz32',function(a){if(a){return a}var b=function(b){b=Number(b)>>>0;if(b===0){return 32}var c=0;if((b&4.29490176E9)===0){b<<=16;c+=16}if((b&4.27819008E9)===0){b<<=8;c+=8}if((b&4.02653184E9)===0){b<<=4;c+=4}if((b&3.221225472E9)===0){b<<=2;c+=2}if((b&2.147483648E9)===0){c++}return c};return b},'es6','es3');$jscomp.polyfill('Math.cosh',function(a){if(a){return a}var b=Math.exp;var c=function(c){c=Number(c);return (b(c)+b(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.expm1',function(a){if(a){return a}var b=function(b){b=Number(b);if(b<0.25&&b>-0.25){var e=b;var f=1;var c=b;var d=0;while(d!=c){e*=b/++f;c=(d=c)+e}return c}return Math.exp(b)-1};return b},'es6','es3');$jscomp.polyfill('Math.hypot',function(a){if(a){return a}var b=function(d,e,h){d=Number(d);e=Number(e);var b,g,f;var c=Math.max(Math.abs(d),Math.abs(e));for(b=2;b<arguments.length;b++){c=Math.max(c,Math.abs(arguments[b]))}if(c>1.0E100||c<1.0E-100){if(!c){return c}d=d/c;e=e/c;f=d*d+e*e;for(b=2;b<arguments.length;b++){g=Number(arguments[b])/c;f+=g*g}return Math.sqrt(f)*c}else {f=d*d+e*e;for(b=2;b<arguments.length;b++){g=Number(arguments[b]);f+=g*g}return Math.sqrt(f)}};return b},'es6','es3');$jscomp.polyfill('Math.imul',function(a){if(a){return a}var b=function(b,c){b=Number(b);c=Number(c);var f=b>>>16&65535;var d=b&65535;var g=c>>>16&65535;var e=c&65535;var h=f*e+d*g<<16>>>0;return d*e+h|0};return b},'es6','es3');$jscomp.polyfill('Math.log10',function(a){if(a){return a}var b=function(b){return Math.log(b)/Math.LN10};return b},'es6','es3');$jscomp.polyfill('Math.log2',function(a){if(a){return a}var b=function(b){return Math.log(b)/Math.LN2};return b},'es6','es3');$jscomp.polyfill('Math.sign',function(a){if(a){return a}var b=function(b){b=Number(b);return b===0||isNaN(b)?b:b>0?1:-1};return b},'es6','es3');$jscomp.polyfill('Math.sinh',function(a){if(a){return a}var b=Math.exp;var c=function(c){c=Number(c);if(c===0){return c}return (b(c)-b(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.tanh',function(a){if(a){return a}var b=function(b){b=Number(b);if(b===0){return b}var c=Math.exp(-2*Math.abs(b));var d=(1-c)/(1+c);return b<0?-d:d};return b},'es6','es3');$jscomp.polyfill('Math.trunc',function(a){if(a){return a}var b=function(b){b=Number(b);if(isNaN(b)||b===Infinity||b===-Infinity||b===0){return b}var c=Math.floor(Math.abs(b));return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Number.EPSILON',function(a){return Math.pow(2,-52)},'es6','es3');$jscomp.polyfill('Number.MAX_SAFE_INTEGER',function(){return 9.007199254740991E15},'es6','es3');$jscomp.polyfill('Number.MIN_SAFE_INTEGER',function(){return -9.007199254740991E15},'es6','es3');$jscomp.polyfill('Number.isFinite',function(a){if(a){return a}var b=function(b){if(typeof b!=='number'){return !1}return !isNaN(b)&&b!==Infinity&&b!==-Infinity};return b},'es6','es3');$jscomp.polyfill('Number.isInteger',function(a){if(a){return a}var b=function(b){if(!Number.isFinite(b)){return !1}return b===Math.floor(b)};return b},'es6','es3');$jscomp.polyfill('Number.isNaN',function(a){if(a){return a}var b=function(b){return typeof b==='number'&&isNaN(b)};return b},'es6','es3');$jscomp.polyfill('Number.isSafeInteger',function(a){if(a){return a}var b=function(b){return Number.isInteger(b)&&Math.abs(b)<=Number.MAX_SAFE_INTEGER};return b},'es6','es3');$jscomp.polyfill('Number.parseFloat',function(a){return a||parseFloat},'es6','es3');$jscomp.polyfill('Number.parseInt',function(a){return a||parseInt},'es6','es3');$jscomp.assign=typeof Object.assign=='function'?Object.assign:function(d,e){for(var c=1;c<arguments.length;c++){var a=arguments[c];if(!a){continue}for(var b in a){if($jscomp.owns(a,b)){d[b]=a[b]}}}return d};$jscomp.polyfill('Object.assign',function(a){return a||$jscomp.assign},'es6','es3');$jscomp.polyfill('Object.entries',function(a){if(a){return a}var b=function(c){var d=[];for(var b in c){if($jscomp.owns(c,b)){d.push([b,c[b]])}}return d};return b},'es8','es3');$jscomp.polyfill('Object.getOwnPropertySymbols',function(a){if(a){return a}return function(){return []}},'es6','es5');$jscomp.polyfill('Reflect.ownKeys',function(b){if(b){return b}var a='jscomp_symbol_';function isSymbol(c){return c.substring(0,a.length)==a}var c=function(e){var f=[];var c=Object.getOwnPropertyNames(e);var d=Object.getOwnPropertySymbols(e);for(var a=0;a<c.length;a++){(isSymbol(c[a])?d:f).push(c[a])}return f.concat(d)};return c},'es6','es5');$jscomp.polyfill('Object.getOwnPropertyDescriptors',function(a){if(a){return a}var b=function(e){var d={};var c=Reflect.ownKeys(e);for(var b=0;b<c.length;b++){d[c[b]]=Object.getOwnPropertyDescriptor(e,c[b])}return d};return b},'es8','es5');$jscomp.polyfill('Object.setPrototypeOf',function(a){return a||$jscomp.setPrototypeOf},'es6','es5');$jscomp.polyfill('Object.values',function(a){if(a){return a}var b=function(b){var c=[];for(var d in b){if($jscomp.owns(b,d)){c.push(b[d])}}return c};return b},'es8','es3');$jscomp.polyfill('Reflect.apply',function(a){if(a){return a}var c=Function.prototype.apply;var b=function(e,d,b){return c.call(e,d,b)};return b},'es6','es3');$jscomp.objectCreate=$jscomp.ASSUME_ES5||typeof Object.create=='function'?Object.create:function(b){var a=function(){};a.prototype=b;return new a()};$jscomp.construct=function(){function reflectConstructWorks(){function Base(){}function Derived(){}new Base();Reflect.construct(Base,[],Derived);return new Base() instanceof Base}if(typeof Reflect!='undefined'&&Reflect.construct){if(reflectConstructWorks()){return Reflect.construct}var b=Reflect.construct;var a=function(e,d,a){var c=b(e,d);if(a){Reflect.setPrototypeOf(c,a.prototype)}return c};return a}function construct(b,d,a){if(a===undefined){a=b}var f=a.prototype||Object.prototype;var c=$jscomp.objectCreate(f);var e=Function.prototype.apply;var g=e.call(b,c,d);return g||c}return construct}();$jscomp.polyfill('Reflect.construct',function(a){return $jscomp.construct},'es6','es3');$jscomp.polyfill('Reflect.defineProperty',function(a){if(a){return a}var b=function(e,d,c){try{Object.defineProperty(e,d,c);var b=Object.getOwnPropertyDescriptor(e,d);if(!b){return !1}return b.configurable===(c.configurable||!1)&&b.enumerable===(c.enumerable||!1)&&('value' in b?b.value===c.value&&b.writable===(c.writable||!1):b.get===c.get&&b.set===c.set)}catch(f){return !1}};return b},'es6','es5');$jscomp.polyfill('Reflect.deleteProperty',function(a){if(a){return a}var b=function(c,b){if(!$jscomp.owns(c,b)){return !0}try{return delete c[b]}catch(d){return !1}};return b},'es6','es3');$jscomp.polyfill('Reflect.getOwnPropertyDescriptor',function(a){return a||Object.getOwnPropertyDescriptor},'es6','es5');$jscomp.polyfill('Reflect.getPrototypeOf',function(a){return a||Object.getPrototypeOf},'es6','es5');$jscomp.findDescriptor=function(d,c){var a=d;while(a){var b=Reflect.getOwnPropertyDescriptor(a,c);if(b){return b}a=Reflect.getPrototypeOf(a)}return undefined};$jscomp.polyfill('Reflect.get',function(a){if(a){return a}var b=function(d,c,e){if(arguments.length<=2){return d[c]}var b=$jscomp.findDescriptor(d,c);if(b){return b.get?b.get.call(e):b.value}return undefined};return b},'es6','es5');$jscomp.polyfill('Reflect.has',function(a){if(a){return a}var b=function(c,b){return b in c};return b},'es6','es3');$jscomp.polyfill('Reflect.isExtensible',function(a){if(a){return a}if($jscomp.ASSUME_ES5||typeof Object.isExtensible=='function'){return Object.isExtensible}return function(){return !0}},'es6','es3');$jscomp.polyfill('Reflect.preventExtensions',function(a){if(a){return a}if(!($jscomp.ASSUME_ES5||typeof Object.preventExtensions=='function')){return function(){return !1}}var b=function(b){Object.preventExtensions(b);return !Object.isExtensible(b)};return b},'es6','es3');$jscomp.polyfill('Reflect.set',function(a){if(a){return a}var b=function(b,d,e,f){var c=$jscomp.findDescriptor(b,d);if(!c){if(Reflect.isExtensible(b)){b[d]=e;return !0}return !1}if(c.set){c.set.call(arguments.length>3?f:b,e);return !0}else {if(c.writable&&!Object.isFrozen(b)){b[d]=e;return !0}}return !1};return b},'es6','es5');$jscomp.polyfill('Reflect.setPrototypeOf',function(a){if(a){return a}else {if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;var c=function(c,d){try{b(c,d);return !0}catch(e){return !1}};return c}else {return null}}},'es6','es5');$jscomp.polyfill('Set',function(b){function isConformant(){if($jscomp.ASSUME_NO_NATIVE_SET||!b||typeof b!='function'||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=b;var d=Object.seal({x:4});var c=new b($jscomp.makeIterator([d]));if(!c.has(d)||c.size!=1||c.add(d)!=c||c.size!=1||c.add({x:4})!=c||c.size!=2){return !1}var e=c.entries();var a=e.next();if(a.done||a.value[0]!=d||a.value[1]!=d){return !1}a=e.next();if(a.done||a.value[0]==d||a.value[0].x!=4||a.value[1]!=a.value[0]){return !1}return e.next().done}catch(f){return !1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE){return b}}else {if(isConformant()){return b}}$jscomp.initSymbol();$jscomp.initSymbolIterator();var a=function(a){this.map_=new Map();if(a){var e=$jscomp.makeIterator(a);var c;while(!(c=e.next()).done){var d=c.value;this.add(d)}}this.size=this.map_.size};a.prototype.add=function(a){a=a===0?0:a;this.map_.set(a,a);this.size=this.map_.size;return this};a.prototype['delete']=function(c){var a=this.map_['delete'](c);this.size=this.map_.size;return a};a.prototype.clear=function(){this.map_.clear();this.size=0};a.prototype.has=function(a){return this.map_.has(a)};a.prototype.entries=function(){return this.map_.entries()};a.prototype.values=function(){return this.map_.values()};a.prototype.keys=a.prototype.values;$jscomp.initSymbol();$jscomp.initSymbolIterator();a.prototype[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(c,a){var d=this;this.map_.forEach(function(e){return c.call(a,e,e,d)})};return a},'es6','es3');$jscomp.checkStringArgs=function(a,c,b){if(a==null){throw new TypeError("The 'this' value for String.prototype."+b+' must not be null or undefined')}if(c instanceof RegExp){throw new TypeError('First argument to String.prototype.'+b+' must not be a regular expression')}return a+''};$jscomp.polyfill('String.prototype.codePointAt',function(a){if(a){return a}var b=function(b){var e=$jscomp.checkStringArgs(this,null,'codePointAt');var f=e.length;b=Number(b)||0;if(!(b>=0&&b<f)){return void 0}b=b|0;var c=e.charCodeAt(b);if(c<55296||c>56319||b+1===f){return c}var d=e.charCodeAt(b+1);if(d<56320||d>57343){return c}return (c-55296)*1024+d+9216};return b},'es6','es3');$jscomp.polyfill('String.prototype.endsWith',function(a){if(a){return a}var b=function(b,c){var d=$jscomp.checkStringArgs(this,b,'endsWith');b=b+'';if(c===void 0){c=d.length}var f=Math.max(0,Math.min(c|0,d.length));var e=b.length;while(e>0&&f>0){if(d[--f]!=b[--e]){return !1}}return e<=0};return b},'es6','es3');$jscomp.polyfill('String.fromCodePoint',function(a){if(a){return a}var b=function(e){var c='';for(var d=0;d<arguments.length;d++){var b=Number(arguments[d]);if(b<0||b>1114111||b!==Math.floor(b)){throw new RangeError('invalid_code_point '+b)}if(b<=65535){c+=String.fromCharCode(b)}else {b-=65536;c+=String.fromCharCode(b>>>10&1023|55296);c+=String.fromCharCode(b&1023|56320)}}return c};return b},'es6','es3');$jscomp.polyfill('String.prototype.includes',function(a){if(a){return a}var b=function(b,c){var d=$jscomp.checkStringArgs(this,b,'includes');return d.indexOf(b,c||0)!==-1};return b},'es6','es3');$jscomp.polyfill('String.prototype.repeat',function(a){if(a){return a}var b=function(b){var c=$jscomp.checkStringArgs(this,null,'repeat');if(b<0||b>1342177279){throw new RangeError('Invalid count value')}b=b|0;var d='';while(b){if(b&1){d+=c}if(b>>>=1){c+=c}}return d};return b},'es6','es3');$jscomp.stringPadding=function(c,a){var b=c!==undefined?String(c):' ';if(!(a>0)||!b){return ''}var d=Math.ceil(a/b.length);return b.repeat(d).substring(0,a)};$jscomp.polyfill('String.prototype.padEnd',function(a){if(a){return a}var b=function(d,c){var b=$jscomp.checkStringArgs(this,null,'padStart');var e=d-b.length;return b+$jscomp.stringPadding(c,e)};return b},'es8','es3');$jscomp.polyfill('String.prototype.padStart',function(a){if(a){return a}var b=function(d,c){var b=$jscomp.checkStringArgs(this,null,'padStart');var e=d-b.length;return $jscomp.stringPadding(c,e)+b};return b},'es8','es3');$jscomp.polyfill('String.prototype.startsWith',function(a){if(a){return a}var b=function(b,g){var c=$jscomp.checkStringArgs(this,b,'startsWith');b=b+'';var h=c.length;var e=b.length;var f=Math.max(0,Math.min(g|0,c.length));var d=0;while(d<e&&f<h){if(c[f++]!=b[d++]){return !1}}return d>=e};return b},'es6','es3');$jscomp.arrayFromIterator=function(c){var b;var a=[];while(!(b=c.next()).done){a.push(b.value)}return a};$jscomp.arrayFromIterable=function(a){if(a instanceof Array){return a}else {return $jscomp.arrayFromIterator($jscomp.makeIterator(a))}};$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var e=$jscomp.setPrototypeOf;e(a,b)}else {for(var c in b){if(c=='prototype'){continue}if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);if(d){Object.defineProperty(a,c,d)}}else {a[c]=b[c]}}}a.superClass_=b.prototype};$jscomp.polyfill('WeakSet',function(a){function isConformant(){if(!a||!Object.seal){return !1}try{var c=Object.seal({});var d=Object.seal({});var b=new a([c]);if(!b.has(c)||b.has(d)){return !1}b['delete'](c);b.add(d);return !b.has(c)&&b.has(d)}catch(e){return !1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE){return a}}else {if(isConformant()){return a}}var b=function(b){this.map_=new WeakMap();if(b){$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=$jscomp.makeIterator(b);var c;while(!(c=e.next()).done){var d=c.value;this.add(d)}}};b.prototype.add=function(b){this.map_.set(b,!0);return this};b.prototype.has=function(b){return this.map_.has(b)};b.prototype['delete']=function(b){return this.map_['delete'](b)};return b},'es6','es3');try{if(Array.prototype.values.toString().indexOf('[native code]')==-1){delete Array.prototype.values}}catch(a){}Ext.define('GeoExt.util.Version',{statics:{isOl3:function(){return !!(ol.animation&&ol.Map.prototype.beforeRender)},isOl4:function(){return !this.isOl3()}}});Ext.define('GeoExt.mixin.SymbolCheck',{extend:'Ext.Mixin',inheritableStatics:{_checked:{},check:function(a){},normalizeSymbol:function(){var a=function(a){};return a}(),checkSymbol:function(a,b){},isDefinedSymbol:function(a){}},onClassMixedIn:function(a){}});Ext.define('GeoExt.component.FeatureRenderer',{extend:'Ext.Component',alias:'widget.gx_renderer',requires:['GeoExt.util.Version'],mixins:['GeoExt.mixin.SymbolCheck'],config:{imgCls:'',minWidth:20,minHeight:20,resolution:1,feature:undefined,pointFeature:undefined,lineFeature:undefined,polygonFeature:undefined,textFeature:undefined,symbolizers:undefined,symbolType:'Polygon'},inheritableStatics:{determineStyle:function(a){var b=a.getFeature();return b.getStyle()||b.getStyleFunction()||(a.store?a.store.layer.getStyle():null)}},initComponent:function(){var a=this;var c=a.getId();a.autoEl={id:c,tag:'div','class':this.getImgCls()};if(!a.getLineFeature()){a.setLineFeature(new ol.Feature({geometry:new ol.geom.LineString([[-8,-3],[-3,3],[3,-3],[8,3]])}))}if(!a.getPointFeature()){a.setPointFeature(new ol.Feature({geometry:new ol.geom.Point([0,0])}))}if(!a.getPolygonFeature()){a.setPolygonFeature(new ol.Feature({geometry:new ol.geom.Polygon([[[-8,-4],[-6,-6],[6,-6],[8,-4],[8,4],[6,6],[-6,6],[-8,4]]])}))}if(!a.getTextFeature()){a.setTextFeature(new ol.Feature({geometry:new ol.geom.Point([0,0])}))}a.map=new ol.Map({controls:[],interactions:[],layers:[new ol.layer.Vector({source:new ol.source.Vector()})]});var b=a.getFeature();if(!b){a.setFeature(a['get'+a.getSymbolType()+'Feature']())}else {a.applyFeature(b)}a.callParent()},onRender:function(){this.callParent(arguments);this.drawFeature()},afterRender:function(){this.callParent(arguments);this.initCustomEvents()},initCustomEvents:function(){var a=this;a.clearCustomEvents();a.el.on('click',a.onClick,a)},clearCustomEvents:function(){var a=this.el;if(a&&a.clearListeners){a.clearListeners()}},onClick:function(){this.fireEvent('click',this)},beforeDestroy:function(){var a=this;a.clearCustomEvents();if(a.map){a.map.setTarget(null)}},onResize:function(){this.setRendererDimensions();this.callParent(arguments)},drawFeature:function(){var a=this;a.map.setTarget(a.el.id);a.setRendererDimensions()},setRendererDimensions:function(){var a=this;var d=a.feature.getGeometry().getExtent();var k=ol.extent.getWidth(d);var j=ol.extent.getHeight(d);var b=a.initialConfig.resolution;if(!b){b=Math.max(k/a.width||0,j/a.height||0)||1}a.map.setView(new ol.View({minResolution:b,maxResolution:b,projection:new ol.proj.Projection({code:'',units:'pixels'})}));var i=Math.max(a.width||a.getMinWidth(),k/b);var h=Math.max(a.height||a.getMinHeight(),j/b);var c=ol.extent.getCenter(d);var f=i*b/2;var e=h*b/2;var g=[c[0]-f,c[1]-e,c[0]+f,c[1]+e];a.el.setSize(Math.round(i),Math.round(h));a.map.updateSize();if(GeoExt.util.Version.isOl3()){a.map.getView().fit(g,a.map.getSize())}else {a.map.getView().fit(g)}},applySymbolizers:function(a){var b=this.getFeature();if(b&&a){b.setStyle(a)}return a},applyFeature:function(a){var b=this.getSymbolizers();if(a&&b){a.setStyle(b)}if(this.map){var c=this.map.getLayers().item(0).getSource();c.clear();c.addFeature(a)}return a},update:function(a){if(a.feature){this.setFeature(a.feature)}if(a.symbolizers){this.setSymbolizers(a.symbolizers)}}});Ext.define('GeoExt.data.model.Base',{extend:'Ext.data.Model',requires:['Ext.data.identifier.Uuid'],identifier:'uuid',schema:{id:'geoext-schema',namespace:'GeoExt.data.model'},inheritableStatics:{loadRawData:function(d){var e=this;var b=e.getProxy().getReader().readRecords(d||{});var a=b.getRecords();var c=b.getSuccess();if(c&&a.length){return a[0]}}}});Ext.define('GeoExt.data.model.Layer',{extend:'GeoExt.data.model.Base',mixins:['GeoExt.mixin.SymbolCheck'],textProperty:'name',descriptionProperty:'description',unnamedLayerText:'Unnamed Layer',unnamedGroupLayerText:'Unnamed Group Layer',synchronizedProperties:['title'],fields:[{name:'isLayerGroup',type:'boolean',persist:!1,convert:function(c,b){var a=b.getOlLayer();if(a){return a instanceof ol.layer.Group}return undefined}},{name:'text',type:'string',persist:!1,convert:function(e,a){var b=e;var c;var d;if(!b){d=a.textProperty;c=a.get('isLayerGroup')?a.unnamedGroupLayerText:a.unnamedLayerText;b=a.getOlLayerProp(d,c)}return b}},{name:'opacity',type:'number',persist:!1,convert:function(b,a){return a.getOlLayerProp('opacity')}},{name:'minResolution',type:'number',persist:!1,convert:function(b,a){return a.getOlLayerProp('minResolution')}},{name:'maxResolution',type:'number',persist:!1,convert:function(b,a){return a.getOlLayerProp('maxResolution')}},{name:'qtip',type:'string',persist:!1,convert:function(b,a){return a.getOlLayerProp(a.descriptionProperty,'')}},{name:'qtitle',type:'string',persist:!1,convert:function(b,a){return a.get('text')}}],proxy:{type:'memory',reader:{type:'json'}},getOlLayer:function(){if(this.data instanceof ol.layer.Base){return this.data}},getOlLayerProp:function(d,c){var a=this.getOlLayer();var b=a?a.get(d):undefined;return b!==undefined?b:c}});Ext.define('GeoExt.data.store.Layers',{extend:'Ext.data.Store',alternateClassName:['GeoExt.data.LayerStore'],requires:['GeoExt.data.model.Layer'],mixins:['GeoExt.mixin.SymbolCheck'],model:'GeoExt.data.model.Layer',config:{map:null,layers:null,changeLayerFilterFn:null},constructor:function(b){var a=this;a.onAddLayer=a.onAddLayer.bind(a);a.onRemoveLayer=a.onRemoveLayer.bind(a);a.onChangeLayer=a.onChangeLayer.bind(a);a.callParent([b]);if(b.map){this.bindMap(b.map)}else {if(b.layers){this.bindLayers(b.layers)}}},bindLayers:function(c,d){var a=this;if(!a.layers){a.layers=c}if(a.layers instanceof ol.layer.Group){a.layers=a.layers.getLayers()}var b=a.layers;b.forEach(function(b){a.loadRawData(b,!0)});b.forEach(function(b){a.bindLayer(b,a.getByLayer(b))});b.on('add',a.onAddLayer);b.on('remove',a.onRemoveLayer);a.on({load:a.onLoad,clear:a.onClear,add:a.onAdd,remove:a.onRemove,update:a.onStoreUpdate,scope:a});a.data.on({replace:a.onReplace,scope:a});a.fireEvent('bind',a,d)},bindMap:function(a){var b=this;if(!b.map){b.map=a}if(a instanceof ol.Map){var c=a.getLayers();b.bindLayers(c,a)}},bindLayer:function(b,a){var c=this;b.on('propertychange',c.onChangeLayer);Ext.Array.forEach(a.synchronizedProperties,function(d){c.synchronize(a,b,d)})},unbindLayers:function(){var a=this;if(a.layers){a.layers.un('add',a.onAddLayer);a.layers.un('remove',a.onRemoveLayer)}a.un('load',a.onLoad,a);a.un('clear',a.onClear,a);a.un('add',a.onAdd,a);a.un('remove',a.onRemove,a);a.un('update',a.onStoreUpdate,a);a.data.un('replace',a.onReplace,a)},unbindMap:function(){var a=this;a.unbindLayers();a.map=null},onChangeLayer:function(c){var b=c.target;var d=this.changeLayerFilterFn?this.changeLayerFilterFn.bind(b):undefined;var a=this.getByLayer(b,d);if(a!==undefined){if(c.key==='description'){a.set('qtip',b.get('description'));if(a.synchronizedProperties.indexOf('description')>-1){this.synchronize(a,b,'description')}}else {if(a.synchronizedProperties.indexOf(c.key)>-1){this.synchronize(a,b,c.key)}else {this.fireEvent('update',this,a,Ext.data.Record.EDIT,null,{})}}}},onAddLayer:function(e){var b=e.element;var d=this.layers.getArray().indexOf(b);var a=this;if(!a._adding){a._adding=!0;var c=a.proxy.reader.read(b);a.insert(d,c.records);delete a._adding}a.bindLayer(b,a.getByLayer(b))},onRemoveLayer:function(d){var a=this;if(!a._removing){var b=d.element;var c=a.getByLayer(b);if(c){a._removing=!0;b.un('propertychange',a.onChangeLayer);a.remove(c);delete a._removing}}},onLoad:function(h,b,g){var a=this;if(g){if(!Ext.isArray(b)){b=[b]}if(!a._addRecords){a._removing=!0;a.layers.forEach(function(c){c.un('propertychange',a.onChangeLayer)});a.layers.getLayers().clear();delete a._removing}var e=b.length;if(e>0){var d=new Array(e);for(var c=0;c<e;c++){var f=b[c];d[c]=f.getOlLayer();a.bindLayer(d[c],f)}a._adding=!0;a.layers.extend(d);delete a._adding}}delete a._addRecords},onClear:function(){var a=this;a._removing=!0;a.layers.forEach(function(b){b.un('propertychange',a.onChangeLayer)});a.layers.clear();delete a._removing},onAdd:function(g,d,e){var a=this;if(!a._adding){a._adding=!0;var b;for(var c=0,f=d.length;c<f;++c){b=d[c].getOlLayer();a.bindLayer(b,d[c]);if(e===0){a.layers.push(b)}else {a.layers.insertAt(e,b)}}delete a._adding}},onRemove:function(i,f){var a=this;var c;var e;var d;var b;var g;if(!a._removing){var h=function(a){if(a===e){d=!0}};for(b=0,g=f.length;b<g;++b){c=f[b];e=c.getOlLayer();d=!1;e.un('propertychange',a.onChangeLayer);a.layers.forEach(h);if(d){a._removing=!0;a.removeMapLayer(c);delete a._removing}}}},onStoreUpdate:function(f,a,c,b){var e=this;if(c===Ext.data.Record.EDIT){if(b){var d=a.getOlLayer();Ext.Array.forEach(b,function(g){if(a.synchronizedProperties.indexOf(g)>-1){e.synchronize(d,a,g)}})}}},removeMapLayer:function(a){this.layers.remove(a.getOlLayer())},onReplace:function(b,a){this.removeMapLayer(a)},getByLayer:function(d,c){var b=this;var a;if(b.getData()){if(Ext.isFunction(c)){a=b.findBy(c)}else {a=b.findBy(function(a){return a.getOlLayer()===d})}if(a>-1){return b.getAt(a)}}},destroy:function(){this.unbindMap();this.callParent()},loadRecords:function(b,a){if(a&&a.addRecords){this._addRecords=!0}this.callParent(arguments)},loadRawData:function(e,d){var a=this;var b=a.proxy.reader.read(e);var c=b.records;if(b.success){a.totalCount=b.total;a.loadRecords(c,d?a.addRecordsOptions:undefined);a.fireEvent('load',a,c,!0)}},synchronize:function(b,d,a){var c=d.get(a);if(c!==b.get(a)){b.set(a,c)}}});Ext.define('GeoExt.component.Map',{extend:'Ext.Component',alias:['widget.gx_map','widget.gx_component_map'],requires:['GeoExt.data.store.Layers','GeoExt.util.Version'],mixins:['GeoExt.mixin.SymbolCheck'],stateEvents:['aftermapmove'],config:{map:null,pointerRest:!1,pointerRestInterval:1000,pointerRestPixelTolerance:3,ignorePointerRestSelectors:[]},mapRendered:!1,layerStore:null,lastPointerPixel:null,isMouseOverMapEl:null,constructor:function(b){var a=this;a.callParent([b]);if(!(a.getMap() instanceof ol.Map)){var c=new ol.Map({view:new ol.View({center:[0,0],zoom:2})});a.setMap(c)}a.layerStore=Ext.create('GeoExt.data.store.Layers',{storeId:a.getId()+'-store',map:a.getMap()});a.bindStateOlEvents();a.on('resize',a.onResize,a)},onResize:function(){var a=this;if(!a.mapRendered){var b=a.getTargetEl?a.getTargetEl():a.element;a.getMap().setTarget(b.dom);a.mapRendered=!0}else {a.getMap().updateSize()}},bufferedPointerMove:Ext.emptyFn,unbufferedPointerMove:function(b){var a=this;var d=a.getPointerRestPixelTolerance();var c=b.pixel;if(a.isMouseOverIgnoreEl(b)){return}if(!a.isMouseOverMapEl){a.fireEvent('pointerrestout',b);return}if(a.lastPointerPixel){var e=Math.abs(a.lastPointerPixel[0]-c[0]);var f=Math.abs(a.lastPointerPixel[1]-c[1]);if(e>d||f>d){a.lastPointerPixel=c}else {a.fireEvent('pointerrest',b,a.lastPointerPixel);return}}else {a.lastPointerPixel=c}a.fireEvent('pointerrest',b,null)},isMouseOverIgnoreEl:function(){var c=this;var a=c.getIgnorePointerRestSelectors();if(a===undefined||a.length===0){return !1}var b=Ext.query(':hover');return b.some(function(b){return a.some(function(a){return b.matches(a)})})},registerPointerRestEvents:function(){var a=this;var b=a.getMap();if(a.bufferedPointerMove===Ext.emptyFn){a.bufferedPointerMove=Ext.Function.createBuffered(a.unbufferedPointerMove,a.getPointerRestInterval(),a)}b.on('pointermove',a.bufferedPointerMove);if(!a.rendered){a.on('afterrender',a.bindOverOutListeners,a)}else {a.bindOverOutListeners()}},bindOverOutListeners:function(){var a=this;var b=a.getTargetEl?a.getTargetEl():a.element;if(b){b.on({mouseover:a.onMouseOver,mouseout:a.onMouseOut,scope:a})}},unbindOverOutListeners:function(){var a=this;var b=a.getTargetEl?a.getTargetEl():a.element;if(b){b.un({mouseover:a.onMouseOver,mouseout:a.onMouseOut,scope:a})}},onMouseOver:function(){this.isMouseOverMapEl=!0},onMouseOut:function(){this.isMouseOverMapEl=!1},unregisterPointerRestEvents:function(){var a=this;var b=a.getMap();a.unbindOverOutListeners();if(b){b.un('pointermove',a.bufferedPointerMove)}a.bufferedPointerMove=Ext.emptyFn},applyPointerRest:function(a){if(a){this.registerPointerRestEvents()}else {this.unregisterPointerRestEvents()}return a},applyPointerRestInterval:function(c){var a=this;var b=a.getPointerRest();if(b){a.setPointerRest(!1);a.setPointerRest(b)}return c},getCenter:function(){return this.getMap().getView().getCenter()},setCenter:function(a){this.getMap().getView().setCenter(a)},getExtent:function(){return this.getView().calculateExtent(this.getMap().getSize())},setExtent:function(a){if(GeoExt.util.Version.isOl3()){this.getView().fit(a,this.getMap().getSize())}else {this.getView().fit(a)}},getLayers:function(){return this.getMap().getLayers()},addLayer:function(a){if(a instanceof ol.layer.Base){this.getMap().addLayer(a)}else {Ext.Error.raise('Can not add layer '+a+' as it is not '+'an instance of ol.layer.Base')}},removeLayer:function(a){if(a instanceof ol.layer.Base){if(Ext.Array.contains(this.getLayers().getArray(),a)){this.getMap().removeLayer(a)}}else {Ext.Error.raise('Can not remove layer '+a+' as it is not '+'an instance of ol.layer.Base')}},getStore:function(){return this.layerStore},getView:function(){return this.getMap().getView()},setView:function(a){this.getMap().setView(a)},bindStateOlEvents:function(){var a=this;var b=a.getMap();b.on('moveend',function(c){a.fireEvent('aftermapmove',a,b,c)})},getState:function(){var b=this;var a=b.getMap().getView();return {zoom:a.getZoom(),center:a.getCenter(),rotation:a.getRotation()}},applyState:function(a){if(!Ext.isObject(a)){return}var c=this;var b=c.getMap().getView();b.setCenter(a.center);b.setZoom(a.zoom);b.setRotation(a.rotation)}});Ext.define('GeoExt.util.Layer',{inheritableStatics:{cascadeLayers:function(b,a){if(!(b instanceof ol.layer.Group)){Ext.Logger.warn('No ol.layer.Group given to '+'BasiGX.util.Layer.cascadeLayers. It is unlikely that '+'this will work properly. Skipping!');return}if(!Ext.isFunction(a)){Ext.Logger.warn('No function passed '+'this will not work. Skipping!');return}b.getLayers().forEach(function(c){a(c);if(c instanceof ol.layer.Group){GeoExt.util.Layer.cascadeLayers(c,a)}})},findParentGroup:function(c,b){var a;var d=GeoExt.util.Layer.findParentGroup;var e=GeoExt.util.Layer.getLayerIndex;if(e(c,b)!==-1){a=b}else {b.getLayers().forEach(function(e){if(!a&&e instanceof ol.layer.Group){a=d(c,e)}})}return a},getLayerIndex:function(c,b){var a=-1;b.getLayers().forEach(function(d,e){if(a===-1&&d===c){a=e}});return a}}});Ext.define('GeoExt.component.OverviewMap',{extend:'Ext.Component',alias:['widget.gx_overview','widget.gx_overviewmap','widget.gx_component_overviewmap'],requires:['GeoExt.util.Version','GeoExt.util.Layer'],mixins:['GeoExt.mixin.SymbolCheck'],inheritableStatics:{getVisibleExtentGeometries:function(c){var a=c&&c.getSize();var e=a&&a[0];var d=a&&a[1];if(!a||isNaN(e)||isNaN(d)){return}var g=[[0,0],[e,0],[e,d],[0,d],[0,0]];var b=[];Ext.each(g,function(d){var a=c.getCoordinateFromPixel(d);if(a===null){return !1}b.push(a)});if(b.length!==5){return}var h=new ol.geom.Polygon([b]);var f=new ol.geom.Point(b[0]);return {extent:h,topLeft:f}}},config:{anchorStyle:null,boxStyle:null,layers:[],magnification:5,map:null,parentMap:null,recenterOnClick:!0,enableBoxDrag:!0,recenterDuration:500},boxFeature:null,anchorFeature:null,extentLayer:null,dragInteraction:null,mapRendered:!1,constructor:function(){this.initOverviewFeatures();this.callParent(arguments)},initComponent:function(){var a=this;if(!a.getParentMap()){Ext.Error.raise('No parentMap defined for overviewMap')}else {if(!(a.getParentMap() instanceof ol.Map)){Ext.Error.raise('parentMap is not an instance of ol.Map')}}a.initOverviewMap();a.on('beforedestroy',a.onBeforeDestroy,a);a.on('resize',a.onResize,a);a.on('afterrender',a.updateBox,a);a.callParent()},initOverviewFeatures:function(){var a=this;a.boxFeature=new ol.Feature();a.anchorFeature=new ol.Feature();a.extentLayer=new ol.layer.Vector({source:new ol.source.Vector()})},initOverviewMap:function(){var a=this;var d=a.getParentMap();var b=a.getMap();a.getLayers().push(a.extentLayer);if(!b){var c=d.getView();var e=new ol.Map({controls:new ol.Collection(),interactions:new ol.Collection(),view:new ol.View({center:c.getCenter(),zoom:c.getZoom(),projection:c.getProjection()})});a.setMap(e)}else {if(b.getView()&&!b.getView().getCenter()){b.getView().setCenter([0,0])}}GeoExt.util.Layer.cascadeLayers(d.getLayerGroup(),function(b){if(a.getLayers().indexOf(b)>-1){throw new Error('OverviewMap cannot use layers of the '+'parent map. (Since ol v6.0.0 maps cannot share '+'layers anymore)')}});Ext.each(a.getLayers(),function(b){a.getMap().addLayer(b)});d.getView().on('propertychange',a.onParentViewPropChange.bind(a));a.enableBoxUpdate();a.setOverviewMapProperty('center');a.setOverviewMapProperty('resolution');a.extentLayer.getSource().addFeatures([a.boxFeature,a.anchorFeature])},setupDragBehaviour:function(){var a=this;var b=new ol.interaction.Translate({features:new ol.Collection([a.boxFeature])});a.getMap().addInteraction(b);b.setActive(!0);b.on('translatestart',a.disableBoxUpdate.bind(a));b.on('translating',a.repositionAnchorFeature.bind(a));b.on('translateend',a.recenterParentFromBox.bind(a));b.on('translateend',a.enableBoxUpdate.bind(a));a.dragInteraction=b},disableBoxUpdate:function(){var a=this;var b=a.getParentMap();if(b){b.un('postrender',a.updateBox,a)}},enableBoxUpdate:function(){var a=this;var b=a.getParentMap();if(b){b.on('postrender',a.updateBox.bind(a))}},destroyDragBehaviour:function(){var a=this;var b=a.dragInteraction;if(!b){return}b.setActive(!1);a.getMap().removeInteraction(b);b.un('translatestart',a.disableBoxUpdate,a);b.un('translating',a.repositionAnchorFeature,a);b.un('translateend',a.recenterParentFromBox,a);b.un('translateend',a.enableBoxUpdate,a);a.dragInteraction=null},repositionAnchorFeature:function(){var a=this;var d=a.boxFeature.getGeometry().getCoordinates();var c=d[0][0];var b=new ol.geom.Point(c);a.anchorFeature.setGeometry(b)},recenterParentFromBox:function(){var c=this;var f=c.getParentMap();var a=f.getView();var e=a.getProjection();var j=c.getMap();var h=j.getView();var d=h.getProjection();var g=a.getCenter();var k=c.boxFeature.getGeometry().getExtent();var b=ol.extent.getCenter(k);if(!ol.proj.equivalent(e,d)){b=ol.proj.transform(b,d,e)}if(GeoExt.util.Version.isOl3()){var i=ol.animation.pan({duration:c.getRecenterDuration(),source:g});f.beforeRender(i);a.setCenter(b)}else {a.animate({center:b})}},onParentViewPropChange:function(a){if(a.key==='center'||a.key==='resolution'){this.setOverviewMapProperty(a.key)}},overviewMapClicked:function(k){var c=this;var f=c.getParentMap();var a=f.getView();var e=a.getProjection();var g=a.getCenter();var j=c.getMap();var h=j.getView();var d=h.getProjection();var b=k.coordinate;if(!ol.proj.equivalent(e,d)){b=ol.proj.transform(b,d,e)}if(GeoExt.util.Version.isOl3()){var i=ol.animation.pan({duration:c.getRecenterDuration(),source:g});f.beforeRender(i);a.setCenter(b)}else {a.animate({center:b})}},updateBox:function(){var a=this;var e=a.getParentMap();var d=a.self.getVisibleExtentGeometries(e);if(!d){return}var g=d.extent;var f=d.topLeft;var b=e.getView().getProjection();var c=a.getMap().getView().getProjection();if(!ol.proj.equivalent(b,c)){g.transform(b,c);f.transform(b,c)}a.boxFeature.setGeometry(g);a.anchorFeature.setGeometry(f)},setOverviewMapProperty:function(g){var b=this;var e=b.getParentMap().getView();var d=e.getProjection();var a=b.getMap().getView();var c=a.getProjection();var f=e.getCenter();if(g==='center'){if(!ol.proj.equivalent(d,c)){f=ol.proj.transform(f,d,c)}a.set('center',f)}if(g==='resolution'){if(ol.proj.equivalent(d,c)){a.set('resolution',b.getMagnification()*e.getResolution())}else {if(b.mapRendered===!0){var i=e.calculateExtent(b.getParentMap().getSize());var h=ol.proj.transformExtent(i,d,c);a.fit(h);a.set('resolution',b.getMagnification()*a.getResolution())}}}},applyRecenterOnClick:function(b){var a=this;var c=a.getMap();if(!c){a.addListener('afterrender',function(){a.setRecenterOnClick(b)},a,{single:!0});return b}if(b){c.on('click',a.overviewMapClicked.bind(a))}else {c.un('click',a.overviewMapClicked.bind(a))}return b},applyEnableBoxDrag:function(b){var a=this;var c=a.getMap();if(!c){a.addListener('afterrender',function(){a.setEnableBoxDrag(b)},a,{single:!0});return b}if(b){a.setupDragBehaviour()}else {a.destroyDragBehaviour()}return b},onBeforeDestroy:function(){var a=this;var c=a.getMap();var b=a.getParentMap();var d=b&&b.getView();if(c){c.un('click',a.overviewMapClicked,a)}a.destroyDragBehaviour();if(b){a.disableBoxUpdate();d.un('propertychange',a.onParentViewPropChange,a)}},onResize:function(){var a=this;var b=a.getEl().dom;var c=a.getMap();if(!a.mapRendered){c.setTarget(b);a.mapRendered=!0;a.setOverviewMapProperty('resolution')}else {a.getMap().updateSize()}},applyAnchorStyle:function(a){this.anchorFeature.setStyle(a);return a},applyBoxStyle:function(a){this.boxFeature.setStyle(a);return a}});Ext.define('GeoExt.component.Popup',{requires:[],extend:'Ext.Component',alias:['widget.gx_popup','widget.gx_component_popup'],config:{overlay:null,map:null},overlayElement:null,overlayElementCreated:!1,cls:'gx-popup',constructor:function(d){var c=this;var a=d||{};var b;if(!Ext.isDefined(a.map)){Ext.Error.raise("Required configuration 'map' not passed")}if(Ext.isDefined(a.renderTo)){b=Ext.get(a.renderTo).dom}else {b=Ext.dom.Helper.append(Ext.getBody(),'<div>');c.overlayElementCreated=!0}a.renderTo=b;c.overlayElement=b;c.callParent([a])},initComponent:function(){var a=this;a.updateLayout=a.updateLayout.bind(a);a.on({afterrender:a.setOverlayElement,beforedestroy:a.onBeforeDestroy,scope:a});a.callParent();a.setupOverlay()},setupOverlay:function(){var b=this;var a=new ol.Overlay({autoPan:!0,autoPanAnimation:{duration:250}});b.getMap().addOverlay(a);a.on('change:position',b.updateLayout);b.setOverlay(a)},setOverlayElement:function(){this.getOverlay().set('element',this.overlayElement)},position:function(a){var b=this;b.getOverlay().setPosition(a)},onBeforeDestroy:function(){var a=this;if(a.overlayElementCreated&&a.overlayElement){var b=a.overlayElement.parentNode;b.removeChild(a.overlayElement)}a.getOverlay().un('change:position',a.doLayout)}});Ext.define('GeoExt.data.model.print.LayoutAttribute',{extend:'GeoExt.data.model.Base',fields:[{name:'name',type:'string'},{name:'type',type:'string'},{name:'clientInfo',type:'auto'},{name:'layoutId',reference:{type:'print.Layout',inverse:'attributes'}}]});Ext.define('GeoExt.data.model.print.Layout',{extend:'GeoExt.data.model.Base',requires:['GeoExt.data.model.print.LayoutAttribute'],fields:[{name:'name',type:'string'},{name:'capabilityId',reference:{type:'print.Capability',inverse:'layouts'}}]});Ext.define('GeoExt.data.model.print.Capability',{extend:'GeoExt.data.model.Base',requires:['GeoExt.data.model.print.Layout'],fields:[{name:'app',type:'string'},{name:'formats',type:'auto',defaultValue:[]}]});Ext.define('GeoExt.data.MapfishPrintProvider',{extend:'Ext.Base',mixins:['Ext.mixin.Observable','GeoExt.mixin.SymbolCheck'],requires:['GeoExt.data.model.print.Capability','Ext.data.JsonStore','Ext.data.Store','Ext.data.proxy.Ajax','Ext.data.proxy.JsonP'],config:{capabilities:null,url:'',useJsonp:!0},inheritableStatics:{_serializers:[],registerSerializer:function(b,a){var c=GeoExt.data.MapfishPrintProvider;c._serializers.push({olSourceCls:b,serializerCls:a})},unregisterSerializer:function(c){var b=GeoExt.data.MapfishPrintProvider._serializers;var a;Ext.each(b,function(b,d){if(b.serializerCls===c){a=d;return !1}});if(Ext.isDefined(a)){Ext.Array.removeAt(b,a);return !0}return !1},findSerializerBySource:function(c){var b=GeoExt.data.MapfishPrintProvider._serializers;var a;Ext.each(b,function(b){if(c instanceof b.olSourceCls){a=b.serializerCls;return !1}});if(!a){Ext.log.warn("Couldn't find a suitable serializer for source."+' Did you require() an appropriate serializer class?')}return a},getLayerArray:function(a){var d=this;var b=[];var c=[];if(a instanceof GeoExt.data.store.Layers){a.each(function(c){var d=c.getOlLayer();b.push(d)})}else {if(a instanceof ol.Collection){b=Ext.clone(a.getArray())}else {b=Ext.clone(a)}}b.forEach(function(b){if(b instanceof ol.layer.Group){Ext.each(d.getLayerArray(b.getLayers()),function(d){c.push(d)})}else {c.push(b)}});return c},getSerializedLayers:function(a,d,e){var g=a.getLayers();var f=a.getView().getResolution();var c=[];var b=this.getLayerArray(g);if(Ext.isDefined(d)){b=Ext.Array.filter(b,d,e)}Ext.each(b,function(i){var h=i.getSource();var b={};var g=this.findSerializerBySource(h);if(g){b=g.serialize(i,h,f,a.map);c.push(b)}},this);return c},renderPrintExtent:function(d,l,i){var g=d.getWidth();var f=d.getHeight();var k=g/f;var h=0.6;var c=i.width/i.height;var b;var a;var j;var e;if(c>=k){b=g*h;a=b/c}else {a=f*h;b=a*c}j=d.getView().calculateExtent([b,a]);e=new ol.Feature(ol.geom.Polygon.fromExtent(j));l.getSource().addFeature(e);return e}},capabilityRec:null,constructor:function(a){this.mixins.observable.constructor.call(this,a);if(!a.capabilities&&!a.url){Ext.Error.raise('Print capabilities or Url required')}this.initConfig(a);this.fillCapabilityRec()},fillCapabilityRec:function(){var b;var d=this.getCapabilities();var e=this.getUrl();var c=function(){this.capabilityRec=b.getAt(0);if(!this.capabilityRec){this.fireEvent('error',this)}else {this.fireEvent('ready',this)}};if(d){b=Ext.create('Ext.data.JsonStore',{model:'GeoExt.data.model.print.Capability',listeners:{datachanged:c,scope:this}});b.loadRawData(d)}else {if(e){var a={url:e};if(this.getUseJsonp()){a.type='jsonp';a.callbackKey='jsonp'}else {a.type='ajax';a.reader={type:'json'}}b=Ext.create('Ext.data.Store',{autoLoad:!0,model:'GeoExt.data.model.print.Capability',proxy:a,listeners:{load:c,scope:this}})}}}});Ext.define('GeoExt.data.model.ArcGISRestServiceLayer',{extend:'GeoExt.data.model.Base',fields:[{name:'layerId',type:'int'},{name:'name',type:'string'},{name:'defaultVisibility',type:'boolean'},{name:'visibility',type:'boolean'}]});Ext.define('GeoExt.data.model.OlObject',{extend:'GeoExt.data.model.Base',mixins:['GeoExt.mixin.SymbolCheck'],inheritableStatics:{getOlCLassRef:function(c){var b=ol;var a;if(Ext.isString(c)){a=c.split('.');if(Ext.Array.indexOf(a,'ol')===0){a.shift()}Ext.Array.each(a,function(a){b=b[a]})}return b}},olClass:'ol.Object',olObject:null,proxy:{type:'memory',reader:'json'},constructor:function(b){var a=this;var d=this.statics();var c=d.getOlCLassRef(this.olClass);b=b||{};if(!(b instanceof c)){b=new c(b)}a.olObject=b;a.callParent([this.olObject.getProperties()]);a.onPropertychange=a.onPropertychange.bind(a);a.olObject.on('propertychange',a.onPropertychange)},onPropertychange:function(a){var c=a.target;var b=a.key;if(!this.__updating){this.set(b,c.get(b))}},set:function(a,c){var b={};this.callParent(arguments);this.__updating=!0;if(Ext.isString(a)){b[a]=c}else {b=a}Ext.Object.each(b,function(b,d){if(this.olObject.get(b)!==d){this.olObject.set(b,d)}},this);this.__updating=!1},destroy:function(){this.olObject.un('propertychange',this.onPropertychange);this.callParent(arguments)}});Ext.define('GeoExt.data.model.Feature',{extend:'GeoExt.data.model.OlObject',getFeature:function(){return this.olObject}});Ext.define('GeoExt.data.model.LayerTreeNode',{extend:'GeoExt.data.model.Layer',requires:['Ext.data.NodeInterface'],mixins:['Ext.mixin.Queryable','GeoExt.mixin.SymbolCheck'],fields:[{name:'leaf',type:'boolean',convert:function(c,b){var a=b.get('isLayerGroup');if(a===undefined||a){return !1}return !0}},{name:'__toggleMode',type:'string',defaultValue:'classic'},{name:'iconCls',type:'string',convert:function(b,a){return a.getOlLayerProp('iconCls')}}],proxy:{type:'memory',reader:{type:'json'}},constructor:function(){var a;this.callParent(arguments);a=this.getOlLayer();if(a instanceof ol.layer.Base){this.set('checked',a.get('visible'));a.on('change:visible',this.onLayerVisibleChange.bind(this))}},onLayerVisibleChange:function(b){var a=b.target;if(!this.__updating){this.set('checked',a.get('visible'))}},set:function(d,b){var a=this;var c=a.get('__toggleMode')==='classic';a.callParent(arguments);if(d==='checked'){if(a.get('__toggleMode')==='ol3'){a.getOlLayer().set('visible',b);return}a.__updating=!0;if(a.get('isLayerGroup')&&c){a.getOlLayer().set('visible',b);if(a.childNodes){a.eachChild(function(a){a.getOlLayer().set('visible',b)})}}else {a.getOlLayer().set('visible',b)}a.__updating=!1;if(c){a.toggleParentNodes(b)}}},toggleParentNodes:function(b){var a=this;if(b===!0){a.__updating=!0;a.bubble(function(a){if(!a.isRoot()){a.set('__toggleMode','ol3');a.set('checked',!0);a.set('__toggleMode','classic')}});a.__updating=!1}if(b===!1){a.__updating=!0;a.bubble(function(a){if(!a.isRoot()){var c=!0;a.eachChild(function(d){if(d.get('checked')){c=!1}});if(c){a.set('__toggleMode','ol3');a.set('checked',!1);a.set('__toggleMode','classic')}}});a.__updating=!1}},getRefItems:function(){return this.childNodes},getRefOwner:function(){return this.parentNode}},function(){Ext.data.NodeInterface.decorate(this)});Ext.define('GeoExt.data.serializer.Base',{extend:'Ext.Base',requires:['GeoExt.data.MapfishPrintProvider'],mixins:['GeoExt.mixin.SymbolCheck'],inheritableStatics:{sourceCls:null,serialize:function(){Ext.raise('This method must be overridden by subclasses.');return null},register:function(a){GeoExt.data.MapfishPrintProvider.registerSerializer(a.sourceCls,a)},validateSource:function(a){if(!(a instanceof this.sourceCls)){Ext.raise('Cannot serialize this source with this serializer')}}}});Ext.define('GeoExt.data.serializer.ImageWMS',{extend:'GeoExt.data.serializer.Base',mixins:['GeoExt.mixin.SymbolCheck'],inheritableStatics:{sourceCls:ol.source.ImageWMS,serialize:function(e,a){this.validateSource(a);var b=a.getParams().STYLES;var c;if(Ext.isArray(b)){c=b}else {c=b?b.split(','):['']}var d={baseURL:a.getUrl(),customParams:a.getParams(),layers:[a.getParams().LAYERS],opacity:e.getOpacity(),styles:c,type:'WMS'};return d}}},function(a){a.register(a)});Ext.define('GeoExt.data.serializer.TileWMS',{extend:'GeoExt.data.serializer.Base',mixins:['GeoExt.mixin.SymbolCheck'],inheritableStatics:{sourceCls:ol.source.TileWMS,serialize:function(e,a){this.validateSource(a);var b=a.getParams().STYLES;var c;if(Ext.isArray(b)){c=b}else {c=b?b.split(','):['']}var d={baseURL:a.getUrls()[0],customParams:a.getParams(),layers:[a.getParams().LAYERS],opacity:e.getOpacity(),styles:c,type:'WMS'};return d}}},function(a){a.register(a)});Ext.define('GeoExt.data.serializer.Vector',{extend:'GeoExt.data.serializer.Base',mixins:['GeoExt.mixin.SymbolCheck'],inheritableStatics:{PRINTSTYLE_TYPES:{POINT:'Point',LINE_STRING:'LineString',POLYGON:'Polygon'},GEOMETRY_TYPE_TO_PRINTSTYLE_TYPE:{},FALLBACK_SERIALIZATION:{geoJson:{type:'FeatureCollection',features:[]},opacity:1,style:{'version':'2','*':{symbolizers:[{type:'point',strokeColor:'white',strokeOpacity:1,strokeWidth:4,strokeDashstyle:'solid',fillColor:'red'}]}},type:'geojson'},FEAT_STYLE_PREFIX:'_gx3_style_',GX_UID_PROPERTY:'__gx_uid__',format:new ol.format.GeoJSON(),sourceCls:ol.source.Vector,serialize:function(i,e,h,j){var a=this;a.validateSource(e);var d;if(j){d=j.getView().calculateExtent()}var l=a.format;var b=[];var f={version:2};var g=function(k){var n=k.getGeometry();if(Ext.isEmpty(n)){return}var m=n.getType();var c=l.writeFeatureObject(k);if(c.properties&&c.properties.parentFeature){c.properties.parentFeature=undefined}var d=null;var g=k.getStyleFunction();if(Ext.isDefined(g)){d=g(k,h)}else {g=i.getStyleFunction();if(Ext.isDefined(g)){d=g(k,h)}}if(!Ext.isArray(d)){d=[d]}if(!Ext.isEmpty(d)){b.push(c);if(Ext.isEmpty(c.properties)){c.properties={}}Ext.each(d,function(g,l){var d=a.getUid(g,m);var b=a.FEAT_STYLE_PREFIX+l;a.encodeVectorStyle(f,m,g,d,b);c.properties[b]=d})}};if(d){e.forEachFeatureInExtent(d,g)}else {Ext.each(e.getFeatures(),g)}var c;if(b.length>0){var k={type:'FeatureCollection',features:b};c={geoJson:k,opacity:i.getOpacity(),style:f,type:'geojson'}}else {c=this.FALLBACK_SERIALIZATION}return c},encodeVectorStyle:function(l,h,c,v,n){var a=this;var e=a.PRINTSTYLE_TYPES;var g=a.GEOMETRY_TYPE_TO_PRINTSTYLE_TYPE;if(!Ext.isDefined(g[h])){return}var f=g[h];var m='['+n+" = '"+v+"']";if(Ext.isDefined(l[m])){return}var b={symbolizers:[]};l[m]=b;var j=c.getFill();var i=c.getImage();var d=c.getStroke();var k=c.getText();var q=!Ext.isEmpty(j);var p=!Ext.isEmpty(i);var o=!Ext.isEmpty(d);var r=!Ext.isEmpty(k);var u=e.POLYGON;var t=e.LINE_STRING;var s=e.POINT;if(f===u&&q){a.encodeVectorStylePolygon(b.symbolizers,j,d)}else {if(f===t&&o){a.encodeVectorStyleLine(b.symbolizers,d)}else {if(f===s&&p){a.encodeVectorStylePoint(b.symbolizers,i)}}}if(r){a.encodeTextStyle(b.symbolizers,k)}},encodeVectorStylePolygon:function(c,d,b){var a={type:'polygon'};this.encodeVectorStyleFill(a,d);if(b!==null){this.encodeVectorStyleStroke(a,b)}c.push(a)},encodeVectorStyleLine:function(c,b){var a={type:'line'};this.encodeVectorStyleStroke(a,b);c.push(a)},encodeVectorStylePoint:function(j,a){var b;if(a instanceof ol.style.Circle){b={type:'point'};b.pointRadius=a.getRadius();var f=a.getFill();if(f!==null){this.encodeVectorStyleFill(b,f)}var e=a.getStroke();if(e!==null){this.encodeVectorStyleStroke(b,e)}}else {if(a instanceof ol.style.Icon){var h=a.getSrc();if(Ext.isDefined(h)){var c=a.getImage(window.devicePixelRatio||1);var d=document.createElement('canvas');d.width=c.naturalWidth||c.width;d.height=c.naturalHeight||c.height;d.getContext('2d').drawImage(c,0,0);var k='image/'+h.match(/\.(\w+)$/)[1];b={type:'point',externalGraphic:d.toDataURL(),graphicFormat:k};var g=a.getRotation();if(g!==0){var i=g*180/Math.PI;b.rotation=i}}}}if(Ext.isDefined(b)){j.push(b)}},encodeTextStyle:function(q,b){var a={type:'Text'};var l=b.getText();if(!Ext.isDefined(l)){return}a.label=l;var h=b.getTextAlign();if(Ext.isDefined(h)){a.labelAlign=h}var g=b.getRotation();if(Ext.isDefined(g)){var n=g*180/Math.PI+'';a.labelRotation=n}var j=b.getOffsetX();var k=b.getOffsetY();if(j){a.labelXOffset=j}if(k){a.labelYOffset=-k}var i=b.getFont();if(Ext.isDefined(i)){var c=document.createElement('span');c.style.font=i;a.fontWeight=c.style.fontWeight;a.fontSize=c.style.fontSize;a.fontFamily=c.style.fontFamily;a.fontStyle=c.style.fontStyle}var d=b.getStroke();if(d!==null&&d.getColor()){var p=d.getColor();var f=ol.color.asArray(p);a.haloColor=this.rgbArrayToHex(f);a.haloOpacity=f[3];var m=d.getWidth();if(Ext.isDefined(m)){a.haloRadius=m}}var e=b.getFill();if(e!==null&&e.getColor()){var o=ol.color.asArray(e.getColor());a.fontColor=this.rgbArrayToHex(o)}if(Ext.isDefined(a.labelAlign)){a.labelXOffset=b.getOffsetX();a.labelYOffset=-b.getOffsetY()}q.push(a)},encodeVectorStyleFill:function(b,d){var c=d.getColor();if(c!==null){var a=ol.color.asArray(c);b.fillColor=this.rgbArrayToHex(a);b.fillOpacity=a[3]}},encodeVectorStyleStroke:function(a,d){var c=d.getColor();if(c!==null){var b=ol.color.asArray(c);a.strokeColor=this.rgbArrayToHex(b);a.strokeOpacity=b[3]}var e=d.getWidth();if(Ext.isDefined(e)){a.strokeWidth=e}},padHexValue:function(a){return a.length===1?'0'+a:a},rgbToHex:function(c,b,a){c=Number(c);b=Number(b);a=Number(a);if(isNaN(c)||c<0||c>255||isNaN(b)||b<0||b>255||isNaN(a)||a<0||a>255){Ext.raise('"('+c+','+b+','+a+'") is not a valid '+' RGB color')}var f=this.padHexValue(c.toString(16));var e=this.padHexValue(b.toString(16));var d=this.padHexValue(a.toString(16));return '#'+f+e+d},rgbArrayToHex:function(a){return this.rgbToHex(a[0],a[1],a[2])},getUid:function(b,c){if(!Ext.isObject(b)){Ext.raise('Cannot get uid of non-object.')}var a=this.GX_UID_PROPERTY;if(c){a+='-'+c}if(!Ext.isDefined(b[a])){b[a]=Ext.id()}return b[a]}}},function(d){var c={POINT:'Point',LINE_STRING:'LineString',LINEAR_RING:'LinearRing',POLYGON:'Polygon',MULTI_POINT:'MultiPoint',MULTI_LINE_STRING:'MultiLineString',MULTI_POLYGON:'MultiPolygon',GEOMETRY_COLLECTION:'GeometryCollection',CIRCLE:'Circle'};var b=d.PRINTSTYLE_TYPES;var a={};a[c.POINT]=b.POINT;a[c.MULTI_POINT]=b.POINT;a[c.LINE_STRING]=b.LINE_STRING;a[c.MULTI_LINE_STRING]=b.LINE_STRING;a[c.POLYGON]=b.POLYGON;a[c.MULTI_POLYGON]=b.POLYGON;d.GEOMETRY_TYPE_TO_PRINTSTYLE_TYPE=a;d.register(d)});Ext.define('GeoExt.data.serializer.WMTS',{extend:'GeoExt.data.serializer.Base',mixins:['GeoExt.mixin.SymbolCheck'],inheritableStatics:{sourceCls:ol.source.WMTS,serialize:function(i,a){this.validateSource(a);var f=a.getProjection();var b=a.getTileGrid();var c=a.getDimensions();var e=Ext.Object.getKeys(c);var h=b.getMatrixIds();var d=[];Ext.each(h,function(g,c){var e=Math.pow(2,c);d.push({identifier:g,scaleDenominator:b.getResolution(c)*f.getMetersPerUnit()/2.8E-4,tileSize:ol.size.toSize(b.getTileSize(c)),topLeftCorner:b.getOrigin(c),matrixSize:[e,e]})});var g={baseURL:a.getUrls()[0],dimensions:e,dimensionParams:c,imageFormat:a.getFormat(),layer:a.getLayer(),matrices:d,matrixSet:a.getMatrixSet(),opacity:i.getOpacity(),requestEncoding:a.getRequestEncoding(),style:a.getStyle(),type:'WMTS',version:a.getVersion()};return g}}},function(a){a.register(a)});Ext.define('GeoExt.data.serializer.XYZ',{extend:'GeoExt.data.serializer.Base',mixins:['GeoExt.mixin.SymbolCheck'],symbols:['ol.layer.Base#getOpacity','ol.size.toSize','ol.source.XYZ','ol.source.XYZ#getTileGrid','ol.source.XYZ#getUrls','ol.tilegrid.TileGrid#getResolutions','ol.tilegrid.TileGrid#getTileSize'],inheritableStatics:{allowedImageExtensions:['png','jpg','gif'],sourceCls:ol.source.XYZ,validateSource:function(a){if(!(a instanceof this.sourceCls)){Ext.raise('Cannot serialize this source with this serializer')}if(a.getUrls()===null){Ext.raise('Cannot serialize this source without an URL. '+'Usage of tileUrlFunction is not yet supported')}},serialize:function(d,a){this.validateSource(a);var b=a.getTileGrid();var c={baseURL:a.getUrls()[0],opacity:d.getOpacity(),imageExtension:this.getImageExtensionFromSource(a)||'png',resolutions:b.getResolutions(),tileSize:ol.size.toSize(b.getTileSize()),type:'OSM'};return c},getImageExtensionFromSource:function(c){var d=c.getUrls();var a=d?d[0]:'';var b=a.substr(a.length-3);if(Ext.isDefined(a)&&Ext.Array.contains(this.allowedImageExtensions,b)){return b}Ext.raise('No url(s) supplied for ',c);return !1}}},function(a){a.register(a)});Ext.define('GeoExt.data.store.ArcGISRestServiceLayer',{extend:'Ext.data.Store',requires:['GeoExt.data.model.ArcGISRestServiceLayer'],model:'GeoExt.data.model.ArcGISRestServiceLayer'});Ext.define('GeoExt.data.store.OlObjects',{extend:'Ext.data.Store',requires:['GeoExt.data.model.OlObject'],mixins:['GeoExt.mixin.SymbolCheck'],olCollection:null,model:'GeoExt.data.model.OlObject',proxy:{type:'memory',reader:'json'},listeners:{add:function(b,c,e){var f=b.olCollection;var d=c.length;var a;b.__updating=!0;for(a=0;a<d;a++){if(!Ext.Array.contains(b.olCollection.getArray(),c[a].olObject)){f.insertAt(e+a,c[a].olObject)}}b.__updating=!1},remove:function(a,b,d){var c=a.olCollection;a.__updating=!0;Ext.each(b,function(e){c.remove(e.olObject)});a.__updating=!1}},constructor:function(a){a=a||{};if(a.data instanceof ol.Collection){this.olCollection=a.data}else {this.olCollection=new ol.Collection(a.data||[])}delete a.data;a.data=this.olCollection.getArray();this.callParent([a])},destroy:function(){delete this.olCollection;this.callParent(arguments)}});Ext.define('GeoExt.data.store.Features',{extend:'GeoExt.data.store.OlObjects',mixins:['GeoExt.mixin.SymbolCheck'],model:'GeoExt.data.model.Feature',config:{layer:null},map:null,createLayer:!1,layerCreated:!1,style:null,features:null,passThroughFilter:!1,constructor:function(e){var a=this;a.onOlCollectionAdd=a.onOlCollectionAdd.bind(a);a.onOlCollectionRemove=a.onOlCollectionRemove.bind(a);var b=e||{};if(a.style===null){a.style=new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:'#3399CC'}),stroke:new ol.style.Stroke({color:'#fff',width:2})})})}if(b.features!==undefined&&b.layer!==undefined){throw new Error('GeoExt.data.store.Features should only be'+' configured with one or less of `features` and `layer`.')}var c='GeoExt.data.store.Features needs to be'+' configured with a feature collection or with a layer with a'+' source with a feature collection.';if(b.features===undefined&&b.layer===undefined){b.data=new ol.Collection()}else {if(b.features!==undefined){if(!(b.features instanceof ol.Collection)){throw new Error('Features are not a collection. '+c)}b.data=b.features}else {if(!(b.layer instanceof ol.layer.BaseVector)){throw new Error('Layer is no vector layer. '+c)}if(!b.layer.getSource()){throw new Error('Layer has no source. '+c)}var d=b.layer.getSource().getFeaturesCollection();if(!d){throw new Error('Source has no collection. '+c)}b.data=d}}a.callParent([b]);if(a.createLayer===!0&&!a.layer){a.drawFeaturesOnMap()}this.olCollection.on('add',this.onOlCollectionAdd);this.olCollection.on('remove',this.onOlCollectionRemove);if(a.passThroughFilter===!0){a.on('filterchange',a.onFilterChange)}},onOlCollectionAdd:function(b){var c=b.target;var a=b.element;var d=Ext.Array.indexOf(c.getArray(),a);if(!this.__updating){this.insert(d,a)}},onOlCollectionRemove:function(c){var b=c.element;var a=this.findBy(function(a){return a.olObject===b});if(a!==-1){if(!this.__updating){this.removeAt(a)}}},applyFields:function(a){var b=this;if(a){this.setModel(Ext.data.schema.Schema.lookupEntity(b.config.model))}},getFeatures:function(){return this.olCollection},getByFeature:function(a){return this.getAt(this.findBy(function(b){return b.getFeature()===a}))},destroy:function(){this.olCollection.un('add',this.onCollectionAdd);this.olCollection.un('remove',this.onCollectionRemove);var a=this;if(a.map&&a.layerCreated===!0){a.map.removeLayer(a.layer)}a.callParent(arguments)},drawFeaturesOnMap:function(){var a=this;a.source=new ol.source.Vector({features:a.getFeatures()});a.layer=new ol.layer.Vector({source:a.source,style:a.style});if(a.map){a.map.addLayer(a.layer)}a.layerCreated=!0},onFilterChange:function(){var a=this;if(a.layer&&a.layer.getSource() instanceof ol.source.Vector){if(!a.__updating){a.__updating=!0;a.olCollection.clear();a.each(function(b){a.olCollection.push(b.getFeature())});delete a.__updating}}}});Ext.define('GeoExt.data.store.LayersTree',{extend:'Ext.data.TreeStore',alternateClassName:['GeoExt.data.TreeStore'],requires:['GeoExt.util.Layer'],mixins:['GeoExt.mixin.SymbolCheck'],model:'GeoExt.data.model.LayerTreeNode',config:{layerGroup:null,folderToggleMode:'classic'},statics:{KEY_COLLAPSE_REMOVE_OPT_OUT:'__remove_by_collapse__'},inverseLayerOrder:!0,collectionEventsSuspended:!1,proxy:{type:'memory',reader:{type:'json'}},root:{expanded:!0},constructor:function(){var a=this;a.onLayerCollectionRemove=a.onLayerCollectionRemove.bind(a);a.onLayerCollectionAdd=a.onLayerCollectionAdd.bind(a);a.bindGroupLayerCollectionEvents=a.bindGroupLayerCollectionEvents.bind(a);a.unbindGroupLayerCollectionEvents=a.unbindGroupLayerCollectionEvents.bind(a);a.callParent(arguments);var b=a.layerGroup.getLayers();Ext.each(b.getArray(),function(b){a.addLayerNode(b)},a,a.inverseLayerOrder);a.bindGroupLayerCollectionEvents(a.layerGroup);a.on({remove:a.handleRemove,noderemove:a.handleNodeRemove,nodeappend:a.handleNodeAppend,nodeinsert:a.handleNodeInsert,scope:a})},applyFolderToggleMode:function(a){if(a==='classic'||a==='ol3'){var b=this.getRootNode();if(b){b.cascadeBy({before:function(b){b.set('__toggleMode',a)}})}return a}Ext.raise('Invalid folderToggleMode set in '+this.self.getName()+': '+a+"; 'classic' or 'ol3' are valid.")},handleRemove:function(d,c){var a=this;var b=a.self.KEY_COLLAPSE_REMOVE_OPT_OUT;a.suspendCollectionEvents();Ext.each(c,function(f){if(b in f&&f[b]===!0){delete f[b];return}var e=f.getOlLayer();if(e instanceof ol.layer.Group){a.unbindGroupLayerCollectionEvents(e)}var g=GeoExt.util.Layer.findParentGroup(e,a.getLayerGroup());if(!g){g=a.getLayerGroup()}if(g){g.getLayers().remove(e)}});a.resumeCollectionEvents()},handleNodeRemove:function(e,c){var a=this;var b=c.getOlLayer();if(!b){b=a.getLayerGroup()}if(b instanceof ol.layer.Group){c.un('beforeexpand',a.onBeforeGroupNodeToggle);c.un('beforecollapse',a.onBeforeGroupNodeToggle);a.unbindGroupLayerCollectionEvents(b)}var d=GeoExt.util.Layer.findParentGroup(b,a.getLayerGroup());if(d){a.suspendCollectionEvents();d.getLayers().remove(b);a.resumeCollectionEvents()}},handleNodeAppend:function(f,e){var b=this;var a=f.getOlLayer();var c=e.getOlLayer();if(!a){a=b.getLayerGroup()}var d=GeoExt.util.Layer.getLayerIndex(c,a);if(d===-1){b.suspendCollectionEvents();if(b.inverseLayerOrder){a.getLayers().insertAt(0,c)}else {a.getLayers().push(c)}b.resumeCollectionEvents()}},handleNodeInsert:function(j,h,g){var b=this;var a=j.getOlLayer();if(!a){a=b.getLayerGroup()}var d=h.getOlLayer();var i=g.getOlLayer();var e=a.getLayers();var k=GeoExt.util.Layer.getLayerIndex(i,a);var c=k;if(b.inverseLayerOrder){c+=1}var f=GeoExt.util.Layer.getLayerIndex(d,a);if(f!==c&&!Ext.Array.contains(e.getArray(),d)){b.suspendCollectionEvents();e.insertAt(c,d);b.resumeCollectionEvents()}},addLayerNode:function(b){var a=this;var d=GeoExt.util.Layer.findParentGroup(b,a.getLayerGroup());var e=GeoExt.util.Layer.getLayerIndex(b,d);if(a.inverseLayerOrder){var g=d.getLayers().getLength();e=g-e-1}var c;if(d===a.getLayerGroup()){c=a.getRootNode()}else {c=a.getRootNode().findChildBy(function(a){return a.getOlLayer()===d},a,!0)}if(!c){return}var f=c.insertChild(e,b);if(b instanceof ol.layer.Group){f.on('beforeexpand',a.onBeforeGroupNodeToggle,a);f.on('beforecollapse',a.onBeforeGroupNodeToggle,a);var h=b.getLayers().getArray();Ext.each(h,a.addLayerNode,a,a.inverseLayerOrder)}},onBeforeGroupNodeToggle:function(b){var a=this.self.KEY_COLLAPSE_REMOVE_OPT_OUT;b.cascadeBy(function(c){c[a]=!0})},bindGroupLayerCollectionEvents:function(c){var b=this;if(c instanceof ol.layer.Group){var a=c.getLayers();a.on('remove',b.onLayerCollectionRemove);a.on('add',b.onLayerCollectionAdd);a.forEach(b.bindGroupLayerCollectionEvents)}},unbindGroupLayerCollectionEvents:function(c){var b=this;if(c instanceof ol.layer.Group){var a=c.getLayers();a.un('remove',b.onLayerCollectionRemove);a.un('add',b.onLayerCollectionAdd);a.forEach(b.unbindGroupLayerCollectionEvents)}},onLayerCollectionAdd:function(c){var a=this;if(a.collectionEventsSuspended){return}var b=c.element;a.addLayerNode(b);a.bindGroupLayerCollectionEvents(b)},onLayerCollectionRemove:function(e){var a=this;if(a.collectionEventsSuspended){return}var b=e.element;var c=a.getRootNode().findChildBy(function(a){return a.getOlLayer()===b},a,!0);if(!c){return}if(b instanceof ol.layer.Group){a.unbindGroupLayerCollectionEvents(b)}var d=c.parentNode;d.removeChild(c)},suspendCollectionEvents:function(){this.collectionEventsSuspended=!0},resumeCollectionEvents:function(){this.collectionEventsSuspended=!1}});Ext.define('GeoExt.util.OGCFilter',{statics:{wfs100GetFeatureXmlTpl:'<wfs:GetFeature service="WFS" version="1.0.0"'+' outputFormat="JSON"'+' xmlns:wfs="http://www.opengis.net/wfs"'+' xmlns="http://www.opengis.net/ogc"'+' xmlns:gml="http://www.opengis.net/gml"'+' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"'+' xsi:schemaLocation="http://www.opengis.net/wfs'+' http://schemas.opengis.net/wfs/1.0.0/WFS-basic.xsd">'+'<wfs:Query typeName="{0}">{1}'+'</wfs:Query>'+'</wfs:GetFeature>',wfs110GetFeatureXmlTpl:'<wfs:GetFeature service="WFS" version="1.1.0"'+' outputFormat="JSON"'+' xmlns:wfs="http://www.opengis.net/wfs"'+' xmlns="http://www.opengis.net/ogc"'+' xmlns:gml="http://www.opengis.net/gml"'+' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"'+' xsi:schemaLocation="http://www.opengis.net/wfs'+' http://schemas.opengis.net/wfs/1.0.0/WFS-basic.xsd">'+'<wfs:Query typeName="{0}">{1}'+'</wfs:Query>'+'</wfs:GetFeature>',wfs200GetFeatureXmlTpl:'<wfs:GetFeature service="WFS" version="2.0.0" '+'xmlns:wfs="http://www.opengis.net/wfs/2.0" '+'xmlns:fes="http://www.opengis.net/fes/2.0" '+'xmlns:gml="http://www.opengis.net/gml/3.2" '+'xmlns:sf="http://www.openplans.org/spearfish" '+'xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '+'xsi:schemaLocation="http://www.opengis.net/wfs/2.0 '+'http://schemas.opengis.net/wfs/2.0/wfs.xsd '+'http://www.opengis.net/gml/3.2 '+'http://schemas.opengis.net/gml/3.2.1/gml.xsd">'+'<wfs:Query typeName="{0}">{1}'+'</wfs:Query>'+'</wfs:GetFeature>',spatialFilterWfs1xXmlTpl:'<{0}>'+'<PropertyName>{1}</PropertyName>'+'{2}'+'</{0}>',spatialFilterWfs2xXmlTpl:'<fes:{0}>'+'<fes:ValueReference>{1}</fes:ValueReference>'+'{2}'+'</fes:{0}>',spatialFilterBBoxTpl:'<BBOX>'+'    <PropertyName>{0}</PropertyName>'+'    <gml:Envelope'+'        xmlns:gml="http://www.opengis.net/gml" srsName="{1}">'+'        <gml:lowerCorner>{2} {3}</gml:lowerCorner>'+'        <gml:upperCorner>{4} {5}</gml:upperCorner>'+'    </gml:Envelope>'+'</BBOX>',gml32PolygonTpl:'<gml:Polygon gml:id="P1" '+'srsName="urn:ogc:def:crs:{0}" srsDimension="2">'+'<gml:exterior>'+'<gml:LinearRing>'+'<gml:posList>{1}</gml:posList>'+'</gml:LinearRing>'+'</gml:exterior>'+'</gml:Polygon>',gml32LineStringTpl:'<gml:LineString gml:id="L1" '+'srsName="urn:ogc:def:crs:{0}" srsDimension="2">'+'<gml:posList>{1}</gml:posList>'+'</gml:LineString>',gml32PointTpl:'<gml:Point gml:id="Pt1" '+'srsName="urn:ogc:def:crs:{0}" srsDimension="2">'+'<gml:pos>{1}</gml:pos>'+'</gml:Point>',filter20StartElementStr:'<fes:Filter '+'xsi:schemaLocation="http://www.opengis.net/fes/2.0 '+'http://schemas.opengis.net/filter/2.0/filterAll.xsd '+'http://www.opengis.net/gml/3.2 '+'http://schemas.opengis.net/gml/3.2.1/gml.xsd" '+'xmlns:fes="http://www.opengis.net/fes/2.0" '+'xmlns:gml="http://www.opengis.net/gml/3.2" '+'xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">',topologicalOrSpatialFilterOperators:['intersect','within','contains','equals','disjoint','crosses','touches','overlaps','bbox'],getOgcWmsFilterFromExtJsFilter:function(b,a){return GeoExt.util.OGCFilter.getOgcFilterFromExtJsFilter(b,'wms',a)},getOgcWfsFilterFromExtJsFilter:function(c,a,b){return GeoExt.util.OGCFilter.getOgcFilterFromExtJsFilter(c,'wfs',a,b)},getOgcFilterFromExtJsFilter:function(a,g,h,e){if(!Ext.isDefined(a)||!Ext.isArray(a)){Ext.Logger.error('Invalid filter argument given to '+'GeoExt.util.OGCFilter. You need to pass an array of '+'"Ext.util.Filter"');return}if(Ext.isEmpty(a)){return null}var c=!1;if(!Ext.isEmpty(g)&&g.toLowerCase()==='wms'){c=!0}var d=[];var f=GeoExt.util.OGCFilter;var b;Ext.each(a,function(c){b=f.getOgcFilterBodyFromExtJsFilterObject(c,e);if(b){d.push(b)}});return f.combineFilters(d,h,c,e)},getOgcFilterBodyFromExtJsFilterObject:function(a,f){if(!Ext.isDefined(a)){Ext.Logger.error('Invalid filter argument given to '+'GeoExt.util.OGCFilter. You need to pass an instance of '+'"Ext.util.Filter"');return}var d=a.getProperty();var c=a.getOperator();var b=a.getValue();var e;if(a.type==='spatial'){e=a.srsName}if(Ext.isEmpty(d)||Ext.isEmpty(c)||Ext.isEmpty(b)){Ext.Logger.warn('Skipping a filter as some values '+'seem to be undefined');return}if(a.isDateValue){if(a.getDateFormat){b=Ext.Date.format(a.getValue(),a.getDateFormat())}else {b=Ext.Date.format(a.getValue(),'Y-m-d')}}return GeoExt.util.OGCFilter.getOgcFilter(d,c,b,f,e)},buildWfsGetFeatureWithFilter:function(e,c,a,d){var f=GeoExt.util.OGCFilter.getOgcWfsFilterFromExtJsFilter(e,c,a);var b=GeoExt.util.OGCFilter.wfs100GetFeatureXmlTpl;if(a&&a==='1.1.0'){b=GeoExt.util.OGCFilter.wfs110GetFeatureXmlTpl}else {if(a&&a==='2.0.0'){b=GeoExt.util.OGCFilter.wfs200GetFeatureXmlTpl}}return Ext.String.format(b,d,f)},getOgcFilter:function(e,f,b,h,m){if(Ext.isEmpty(e)||Ext.isEmpty(f)||Ext.isEmpty(b)){Ext.Logger.error('Invalid argument given to method '+'`getOgcFilter`. You need to supply property, '+'operator and value.');return}var a;var g;var d='PropertyName';var k=!Ext.isEmpty(h)&&h==='2.0.0';if(k){d='fes:ValueReference'}if(!(b instanceof ol.geom.Geometry)){b=b.toString().replace(/(^['])/g,'');b=b.toString().replace(/([']$)/g,'')}var c=k?'fes:':'';switch(f){case '==':case '=':case 'eq':a=c+'PropertyIsEqualTo';break;case '!==':case '!=':case 'ne':a=c+'PropertyIsNotEqualTo';break;case 'lt':case '<':a=c+'PropertyIsLessThan';break;case 'lte':case '<=':a=c+'PropertyIsLessThanOrEqualTo';break;case 'gt':case '>':a=c+'PropertyIsGreaterThan';break;case 'gte':case '>=':a=c+'PropertyIsGreaterThanOrEqualTo';break;case 'like':b='*'+b+'*';var r='<{0}PropertyIsLike wildCard="*" singleChar="."'+' escape="!" matchCase="false">'+'<'+d+'>'+e+'</'+d+'>'+'<{0}Literal>'+b+'</{0}Literal>'+'</{0}PropertyIsLike>';return Ext.String.format(r,c);case 'in':a=c+'Or';var l=b;if(!Ext.isArray(b)){b=b.replace(/([()'])/g,'');l=b.split(',')};var j='';Ext.each(l||b,function(a){j+='<'+c+'PropertyIsEqualTo>'+'<'+d+'>'+e+'</'+d+'>'+'<'+c+'Literal>'+a+'</'+c+'Literal>'+'</'+c+'PropertyIsEqualTo>'});a='<'+a+'>';var i;g=Ext.String.insert(a,'/',1);if(l.length>1){i=a+j+g}else {i=j};return i;case 'intersect':case 'within':case 'contains':case 'equals':case 'disjoint':case 'crosses':case 'touches':case 'overlaps':switch(f){case 'equals':a='Equals';break;case 'contains':a='Contains';break;case 'within':a='Within';break;case 'disjoint':a='Disjoint';break;case 'touches':a='Touches';break;case 'crosses':a='Crosses';break;case 'overlaps':a='Overlaps';break;case 'intersect':a='Intersects';break;default:Ext.Logger.warn('Method `getOgcFilter` could not '+'handle the given topological operator: '+f);return;};var s=GeoExt.util.OGCFilter.getGmlElementForGeometry(b,m,h);var u=h!=='2.0.0'?GeoExt.util.OGCFilter.spatialFilterWfs1xXmlTpl:GeoExt.util.OGCFilter.spatialFilterWfs2xXmlTpl;return Ext.String.format(u,a,e,s);case 'bbox':var n;var o;var p;var q;b=b.getExtent();n=b[0];o=b[1];p=b[2];q=b[3];return Ext.String.format(GeoExt.util.OGCFilter.spatialFilterBBoxTpl,e,m,n,o,p,q);default:Ext.Logger.warn('Method `getOgcFilter` could not '+'handle the given operator: '+f);return;}a='<'+a+'>';g=Ext.String.insert(a,'/',1);var t=k?'<fes:Literal>{2}</fes:Literal>':'<Literal>{2}</Literal>';var w=''+'{0}'+'<'+d+'>{1}</'+d+'>'+t+'{3}';var v=Ext.String.format(w,a,e,b,g);return v},getGmlElementForGeometry:function(b,c,m){if(m==='2.0.0'){var i=b.getType();var a=GeoExt.util.OGCFilter;var h=i.indexOf('Multi')>-1;switch(i){case 'Polygon':case 'MultiPolygon':var f=b.getCoordinates()[0];if(h){f=f[0]};return Ext.String.format(a.gml32PolygonTpl,c,a.flattenCoordinates(f));case 'LineString':case 'MultiLineString':var e=b.getCoordinates();if(h){e=e[0]};return Ext.String.format(a.gml32LineStringTpl,c,a.flattenCoordinates(e));case 'Point':case 'MultiPoint':var g=b.getCoordinates();if(h){g=g[0]};return Ext.String.format(a.gml32PointTpl,c,a.flattenCoordinates(g));default:return '';}}else {var o=new ol.format.GML3({srsName:c});var d=o.writeGeometryNode(b,{dataProjection:c});if(!d){Ext.Logger.warn('Could not serialize geometry');return null}var k=d.children||d.childNodes;var l=new XMLSerializer();var n=k[0];var j=l.serializeToString(n);return j}},flattenCoordinates:function(a){return Ext.Array.map(a,function(b){return b.join(' ')}).join(' ')},combineFilterBodies:function(a,h,e){if(!Ext.isDefined(a)||!Ext.isArray(a)||a.length===0){Ext.Logger.error('Invalid "filterBodies" argument given to '+'GeoExt.util.OGCFilter. You need to pass an array of '+'OGC filter bodies as XML string');return}var f=h||'And';var j=!Ext.isEmpty(e)&&e==='2.0.0';var i=j?'fes:':'';var c=i+f;var d=c='<'+c+'>';var g=Ext.String.insert(d,'/',1);var b='';if(a.length>1){Ext.each(a,function(c){b+=c});b=d+b+g}else {b=a[0]}return b},combineFilters:function(g,i,b,d){var j=GeoExt.util.OGCFilter;var h='And';var e=i||h;var f=g.length;var a=[];var k=b?'':'ogc';var c=!d||d==='1.0.0';if(!Ext.isEmpty(d)&&d==='2.0.0'&&!b){a.push(j.filter20StartElementStr)}else {a.push('<Filter'+(b?'':' xmlns="http://www.opengis.net/'+k+'"'+' xmlns:gml="http://www.opengis.net/gml"')+'>');c=!0}a.push();if(f>1){a.push('<'+(b||c?'':'fes:')+e+'>')}Ext.each(g,function(c){a.push(c)});if(f>1){a.push('</'+(b||c?'':'fes:')+e+'>')}a.push('</'+(b||c?'':'fes:')+'Filter>');return a.join('')},createSpatialFilter:function(a,b,d,c){if(!Ext.Array.contains(GeoExt.util.OGCFilter.topologicalOrSpatialFilterOperators,a)){return null}return new Ext.util.Filter({type:'spatial',srsName:c,operator:a,property:b,value:d})}}});Ext.define('GeoExt.data.store.WfsFeatures',{extend:'GeoExt.data.store.Features',mixins:['GeoExt.mixin.SymbolCheck','GeoExt.util.OGCFilter'],autoLoad:!0,remoteSort:!0,remoteFilter:!0,logicalFilterCombinator:'And',requestMethod:'GET',service:'WFS',version:'2.0.0',request:'GetFeature',typeName:null,srsName:null,outputFormat:'application/json',startIndex:0,count:null,propertyName:null,startIndexOffset:0,format:null,layerAttribution:null,layerOptions:null,cacheFeatureCount:!1,featureCountOutputFormat:'gml3',debounce:300,constructor:function(b){var a=this;b=b||{};b.pageSize=b.count||a.count;if(b.pageSize>0){var e=b.startIndex||a.startIndex;b.currentPage=Math.floor(e/b.pageSize)+1}var d=b.createLayer;b.createLayer=!1;b.passThroughFilter=!1;a.callParent([b]);a.loadWfsTask_=new Ext.util.DelayedTask();if(!a.url){Ext.raise('No URL given to WfsFeaturesStore')}if(d){a.source=new ol.source.Vector({features:new ol.Collection(),attributions:a.layerAttribution});var c={source:a.source,style:a.style};if(a.layerOptions){Ext.applyIf(c,a.layerOptions)}a.layer=new ol.layer.Vector(c);a.layerCreated=!0}if(a.cacheFeatureCount===!0){a.cacheTotalFeatureCount(!a.autoLoad)}else {if(a.autoLoad){a.loadWfs()}}a.on('beforeload',a.loadWfs,a);if(a.map&&a.layer){a.map.addLayer(a.layer)}},getTotalFeatureCount:function(a){var b=-1;var d=a.getResponseHeader('Content-Type');try{if(d.indexOf('application/json')!==-1){var e=Ext.decode(a.responseText);b=e.numberMatched}else {var c=a.responseXML;if(c&&c.firstChild){var f=c.firstChild.getAttribute('numberMatched');b=parseInt(f,10)}}}catch(g){Ext.Logger.warn('Error while detecting total feature count from '+'WFS response')}return b},createSortByParameter:function(){var d=this;var a=[];var b;var c;d.getSorters().each(function(d){b=d.getDirection();c=d.getProperty();a.push(Ext.String.format('{0} {1}',c,b))});return a.join(',')},createOgcFilter:function(){var b=this;var a=[];b.getFilters().each(function(b){a.push(b)});if(a.length===0){return null}return GeoExt.util.OGCFilter.getOgcWfsFilterFromExtJsFilter(a,b.logicalFilterCombinator,b.version)},cacheTotalFeatureCount:function(b){var a=this;var d=a.url;a.cachedTotalCount=0;var c={service:a.service,version:a.version,request:a.request,typeName:a.typeName,outputFormat:a.featureCountOutputFormat,resultType:'hits'};Ext.Ajax.request({url:d,method:a.requestMethod,params:c,success:function(c){a.cachedTotalCount=a.getTotalFeatureCount(c);if(!b){a.loadWfs()}},failure:function(a){Ext.Logger.warn('Error while requesting features from WFS: '+a.responseText+' Status: '+a.status)}})},onFilterChange:function(){var a=this;if(a.getFilters()&&a.getFilters().length>0){a.loadWfs()}},createParameters:function(){var a=this;var b={service:a.service,version:a.version,request:a.request,typeName:a.typeName,outputFormat:a.outputFormat};if(a.propertyName!==null){b.propertyName=a.propertyName}if(a.srsName){b.srsName=a.srsName}else {if(a.map){b.srsName=a.map.getView().getProjection().getCode()}}if(a.remoteSort===!0){var d=a.createSortByParameter();if(d){b.sortBy=d}}if(a.remoteFilter===!0){var c=a.createOgcFilter();if(c){b.filter=c}}if(a.pageSize){a.startIndex=(a.currentPage-1)*a.pageSize+a.startIndexOffset;b.startIndex=a.startIndex;b.count=a.pageSize}return b},loadWfs:function(){var a=this;if(a.loadWfsTask_.id===null){a.loadWfsTask_.delay(a.debounce,function(){});a.loadWfsInternal()}else {a.loadWfsTask_.delay(a.debounce,function(){a.loadWfsInternal()})}},loadWfsInternal:function(){var a=this;var c=a.url;var b=a.createParameters();if(a.fireEvent('gx-wfsstoreload-beforeload',a,b)===!1){return}Ext.Ajax.request({url:c,method:a.requestMethod,params:b,success:function(c){if(!a.format){Ext.Logger.warn('No format given for WfsFeatureStore. '+'Skip parsing feature data.');return}if(a.cacheFeatureCount===!0){a.totalCount=a.cachedTotalCount}else {a.totalCount=a.getTotalFeatureCount(c)}var b=[];try{b=a.format.readFeatures(c.responseText)}catch(d){Ext.Logger.warn('Error parsing features into the '+'OpenLayers format. Check the server response.')}a.setData(b);if(a.layer){a.source.clear();a.source.addFeatures(b)}a.fireEvent('gx-wfsstoreload',a,b,!0)},failure:function(b){if(b.aborted!==!0){Ext.Logger.warn('Error while requesting features from WFS: '+b.responseText+' Status: '+b.status)}a.fireEvent('gx-wfsstoreload',a,null,!1)}})},doDestroy:function(){var a=this;if(a.loadWfsTask_.id!==null){a.loadWfsTask_.cancel()}a.callParent(arguments)}});Ext.define('GeoExt.plugin.layertreenode.ContextMenu',{extend:'Ext.plugin.Abstract',alias:'plugin.gx_layertreenode_contextmenu',contextUi:null,recreateContextUi:!0,init:function(a){var b=this;if(!(a instanceof Ext.tree.Column)){Ext.log.warn('Plugin shall only be applied to instances of'+' Ext.tree.Column');return}a.on('contextmenu',b.onContextMenu,b)},onContextMenu:function(d,g,f,e,b,c){var a=this;b.preventDefault();if(a.contextUi&&a.recreateContextUi){a.contextUi.destroy();a.contextUi=null}if(!a.contextUi){a.contextUi=a.createContextUi(c)}a.showContextUi(b.getXY())},createContextUi:function(a){Ext.Logger.warn('gx_layertreenode_contextmenu: createContextUi is '+"not overwritten. It is very likely that the plugin won't work");return null},showContextUi:function(a){var b=this;if(b.contextUi&&a){b.contextUi.showAt(a)}}});Ext.define('GeoExt.form.field.GeocoderComboBox',{extend:'Ext.form.field.ComboBox',alias:['widget.gx_geocoder_combo','widget.gx_geocoder_combobox','widget.gx_geocoder_field'],requires:['Ext.data.JsonStore'],mixins:['GeoExt.mixin.SymbolCheck'],map:null,locationLayer:null,locationLayerStyle:null,store:null,proxyRootProperty:null,displayField:'name',displayValueMapping:'display_name',valueField:'extent',queryParam:'q',emptyText:'Search for a location',minChars:3,queryDelay:100,url:'https://nominatim.openstreetmap.org/search?format=json',srs:'EPSG:4326',zoom:10,showLocationOnMap:!0,restrictToMapExtent:!1,initComponent:function(){var a=this;a.updateExtraParams=a.updateExtraParams.bind(a);if(!a.store){a.store=Ext.create('Ext.data.JsonStore',{fields:[{name:'name',mapping:a.displayValueMapping},{name:'extent',convert:a.convertToExtent},{name:'coordinate',convert:a.convertToCoordinate}],proxy:{type:'ajax',url:a.url,reader:{type:'json',rootProperty:a.proxyRootProperty}}})}if(!a.locationLayer){a.locationLayer=new ol.layer.Vector({source:new ol.source.Vector(),style:a.locationLayerStyle!==null?a.locationLayerStyle:undefined});if(a.map){a.map.addLayer(a.locationLayer)}}a.callParent(arguments);a.on({unRestrictMapExtent:a.unRestrictExtent,restrictToMapExtent:a.restrictExtent,select:a.onSelect,focus:a.onFocus,scope:a});if(a.restrictToMapExtent){a.restrictExtent()}},restrictExtent:function(){var a=this;a.map.on('moveend',a.updateExtraParams);a.updateExtraParams()},updateExtraParams:function(){var a=this;var c=a.map.getSize();var b=a.map.getView();var d=b.calculateExtent(c);a.addMapExtentParams(d,b.getProjection())},addMapExtentParams:function(c,b){var a=this;if(!b){b=a.map.getView().getProjection()}var d=ol.proj.transform([c[0],c[1]],b,'EPSG:4326');var e=ol.proj.transform([c[2],c[3]],b,'EPSG:4326');d=Ext.Array.map(d,function(a){return Math.min(Math.max(a,-180),180)});e=Ext.Array.map(e,function(a){return Math.min(Math.max(a,-180),180)});var f=[d.join(','),e.join(',')].join(',');if(a.store&&a.store.getProxy()){a.store.getProxy().setExtraParam('viewbox',f);a.store.getProxy().setExtraParam('bounded','1')}},unRestrictExtent:function(){var a=this;a.map.un('moveend',a.updateExtraParams);a.removeMapExtentParams()},removeMapExtentParams:function(){var a=this;if(a.store&&a.store.getProxy()){a.store.getProxy().setExtraParam('viewbox',undefined);a.store.getProxy().setExtraParam('bounded',undefined)}},convertToExtent:function(g,f){var a=f.get('boundingbox');var d=parseFloat(a[2],10);var e=parseFloat(a[0],10);var b=parseFloat(a[3],10);var c=parseFloat(a[1],10);return [d,e,b,c]},convertToCoordinate:function(b,a){return [parseFloat(a.get('lon'),10),parseFloat(a.get('lat'),10)]},drawLocationFeatureOnMap:function(a){var c=this;var b;if(a.length===2){b=new ol.geom.Point(a)}else {if(a.length===4){b=ol.geom.Polygon.fromExtent(a)}}if(b){var d=new ol.Feature({geometry:b});c.locationLayer.getSource().clear();c.locationLayer.getSource().addFeature(d)}},removeLocationFeature:function(){this.locationLayer.getSource().clear()},onFocus:function(){var a=this;a.clearValue();a.removeLocationFeature()},onSelect:function(g,f){var a=this;if(!a.map){Ext.Logger.warn('No map configured in '+'GeoExt.form.field.GeocoderComboBox. Skip zoom to selection.');return}var d=f.get(a.valueField);var b;var c=a.map.getView();var e=c.getProjection().getCode();if(d.length===2){b=ol.proj.transform(d,a.srs,e);c.setCenter(b);c.setZoom(a.zoom)}else {if(d.length===4){b=ol.proj.transformExtent(d,a.srs,e);c.fit(b)}}if(a.showLocationOnMap){a.drawLocationFeatureOnMap(b)}}});Ext.define('GeoExt.selection.FeatureModelMixin',{extend:'Ext.Mixin',mixinConfig:{after:{bindComponent:'bindFeatureModel'},before:{destroy:'unbindOlEvents',constructor:'onConstruct',onSelectChange:'beforeSelectChange'}},config:{layer:null,map:null,mapSelection:!1,selectionTolerance:12,selectStyle:new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:'rgba(255,255,255,0.8)'}),stroke:new ol.style.Stroke({color:'darkblue',width:2})}),fill:new ol.style.Fill({color:'rgba(255,255,255,0.8)'}),stroke:new ol.style.Stroke({color:'darkblue',width:2})})},existingFeatStyles:{},mapClickRegistered:!1,selectedFeatureAttr:'gx_selected',selectedFeatures:null,onConstruct:function(){var a=this;a.onSelectFeatAdd=a.onSelectFeatAdd.bind(a);a.onSelectFeatRemove=a.onSelectFeatRemove.bind(a);a.onFeatureClick=a.onFeatureClick.bind(a)},bindFeatureModel:function(){var b=this;if(!b.layer||!(b.layer instanceof ol.layer.Vector)){var a=b.getStore();if(a&&a.getLayer&&a.getLayer()&&a.getLayer() instanceof ol.layer.Vector){b.layer=a.getLayer()}}b.bindOlEvents()},bindOlEvents:function(){if(!this.bound_){var a=this;a.selectedFeatures=new ol.Collection();a.selectedFeatures.on('add',a.onSelectFeatAdd);a.selectedFeatures.on('remove',a.onSelectFeatRemove);if(a.mapSelection&&a.layer&&a.map){a.map.on('singleclick',a.onFeatureClick);a.mapClickRegistered=!0}this.bound_=!0}},unbindOlEvents:function(){var a=this;if(a.selectedFeatures){a.selectedFeatures.un('add',a.onSelectFeatAdd);a.selectedFeatures.un('remove',a.onSelectFeatRemove)}if(a.mapClickRegistered){a.map.un('singleclick',a.onFeatureClick);a.mapClickRegistered=!1}},onSelectFeatAdd:function(d){var b=this;var a=d.element;if(a){if(a.getStyle()){var c=a.getId()||b.getRandomFid();b.existingFeatStyles[c]=a.getStyle();a.setId(c)}a.setStyle(b.selectStyle)}},onSelectFeatRemove:function(d){var c=this;var a=d.element;if(a){var b=a.getId();if(b&&c.existingFeatStyles[b]){a.setStyle(c.existingFeatStyles[b]);delete c.existingFeatStyles[b]}else {a.setStyle()}}},onFeatureClick:function(c){var a=this;var b=a.map.forEachFeatureAtPixel(c.pixel,function(a){return a},{layerFilter:function(b){return b===a.layer},hitTolerance:a.selectionTolerance});if(b){a.selectMapFeature(b)}},selectMapFeature:function(c){var a=this;var b=a.store.findBy(function(a,b){return a.getFeature()===c});if(a.getSelectionMode()==='SINGLE'){a.deselectAll()}if(c.get(a.selectedFeatureAttr)){a.deselect(b)}else {if(b!==-1&&!a.isSelected(b)){a.select(b,!this.singleSelect);a.view.focusRow(b)}}},beforeSelectChange:function(d,c){var b=this;var a=d.getFeature();var e=!0;a.set(b.selectedFeatureAttr,c,e);if(c){b.selectedFeatures.push(a)}else {b.selectedFeatures.remove(a)}},getRandomFid:function(){return (new Date()).getTime()+''+Math.floor(Math.random()*11)}});Ext.define('GeoExt.selection.FeatureCheckboxModel',{extend:'Ext.selection.CheckboxModel',alias:['selection.featurecheckboxmodel'],mixins:['GeoExt.selection.FeatureModelMixin']});Ext.define('GeoExt.selection.FeatureRowModel',{alternateClassName:'GeoExt.selection.FeatureModel',extend:'Ext.selection.RowModel',alias:['selection.featuremodel','selection.featurerowmodel'],mixins:['GeoExt.selection.FeatureModelMixin']});Ext.define('GeoExt.state.PermalinkProvider',{extend:'Ext.state.Provider',requires:[],alias:'state.gx_permalinkprovider',mapState:null,constructor:function(){var a=this;a.callParent(arguments);if(window.location.hash!==''){a.mapState=a.readPermalinkHash(window.location.hash)}},readPermalinkHash:function(c){var b;var d=c.replace('#map=','');var a=d.split('/');if(a.length===4){b={zoom:parseInt(a[0],10),center:[parseFloat(a[1]),parseFloat(a[2])],rotation:parseFloat(a[3])}}return b},getPermalinkHash:function(d){var f=this;var a=f.mapState;var b=a.center[0];var c=a.center[1];if(d){b=Math.round(b*100)/100;c=Math.round(c*100)/100}var e='#map='+a.zoom+'/'+b+'/'+c+'/'+a.rotation;return e},set:function(c,b){var a=this;a.mapState=b;a.callParent(arguments)}});Ext.define('GeoExt.toolbar.WfsPaging',{extend:'Ext.toolbar.Paging',xtype:'gx_wfspaging_toolbar',onBindStore:function(){var a=this;a.callParent(arguments);a.store.on('gx-wfsstoreload',a.onLoad,a)}});